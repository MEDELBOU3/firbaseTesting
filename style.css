      /*------------------------------------*\
          $ROOT VARIABLES & BASE STYLES
        \*------------------------------------*/
        :root {
            /* Color Palette (Light Theme - Graphite Inspired) */
            --bg-primary: #f1f3f5;         /* Very light gray */
            --bg-secondary: #ffffff;       /* White */
            --bg-tertiary: #e9ecef;       /* Lighter gray */
            --bg-accent: #dee2e6;         /* Light Gray for borders */
            --text-primary: #212529;       /* Dark Gray */
            --text-secondary: #6c757d;     /* Medium Gray */
            --text-accent: #495057;        /* Slightly darker medium Gray */
            --primary-color: #4c6ef5;      /* Indigo Blue */
            --primary-color-rgb: 76, 110, 245;
            --primary-text: #ffffff;
            --success-color: #20c997;      /* Teal */
            --success-color-rgb: 32, 201, 151;
            --danger-color: #fa5252;       /* Red */
            --danger-text: #ffffff;
            --warning-color: #fab005;      /* Yellow */
            --message-sent-bg: var(--primary-color);
            --message-sent-text: var(--primary-text);
            --message-received-bg: var(--bg-tertiary);
            --message-received-text: var(--text-primary);
            --link-color: var(--primary-color);
            --navbar-bg: var(--bg-secondary);
            --navbar-text: var(--text-primary);
            --navbar-border: var(--bg-accent);
            --sidebar-bg: var(--bg-secondary);
            --sidebar-border: var(--bg-accent);
            --sidebar-header-bg: var(--bg-primary);
            --avatar-placeholder-bg: #adb5bd;
            --avatar-placeholder-text: #ffffff;
            --shadow-sm: 0 1px 3px rgba(0, 0, 0, .05);
            --shadow: 0 4px 8px rgba(0, 0, 0, .07);
            --shadow-lg: 0 10px 20px rgba(0, 0, 0, .08);
            --border-radius-sm: 0.25rem;
            --border-radius: 0.5rem;
            --border-radius-lg: 0.75rem;
            --transition-speed: 0.2s;
            --skeleton-bg: #e0e0e0;
            --skeleton-shine-color: #f0f0f0;
        }

        /* Dark Theme (Graphite Dark) */
        .theme-dark {
            --bg-primary: #1a1d21;
            --bg-secondary: #212529;
            --bg-tertiary: #343a40;
            --bg-accent: #495057;
            --text-primary: #e9ecef;
            --text-secondary: #adb5bd;
            --text-accent: #ced4da;
            --primary-color: #748ffc; /* Lighter Indigo */
            --primary-color-rgb: 116, 143, 252;
            --success-color: #40c057; /* Slightly Adjusted Green */
            --success-color-rgb: 64, 192, 87;
            --danger-color: #ff6b6b; /* Adjusted Red */
            --warning-color: #fcc419; /* Adjusted Yellow */
            --message-sent-bg: var(--primary-color);
            --message-sent-text: #0c0d0e; /* Dark text on lighter blue */
            --message-received-bg: var(--bg-tertiary);
            --message-received-text: var(--text-primary);
            --link-color: var(--primary-color);
            --navbar-bg: var(--bg-secondary);
            --navbar-text: var(--text-primary);
            --navbar-border: var(--bg-accent);
            --sidebar-bg: var(--bg-secondary);
            --sidebar-border: var(--bg-accent);
            --sidebar-header-bg: var(--bg-tertiary);
            --avatar-placeholder-bg: #6c757d;
            --shadow-sm: 0 1px 3px rgba(0, 0, 0, .2);
            --shadow: 0 4px 8px rgba(0, 0, 0, .3);
            --shadow-lg: 0 10px 20px rgba(0, 0, 0, .35);
            --skeleton-bg: #343a40;
            --skeleton-shine-color: #495057;
        }

        /* Sapphire Sea Theme */
        .theme-sapphire {
            --bg-primary: #e6f7ff;         /* Very Light Blue */
            --bg-secondary: #ffffff;
            --bg-tertiary: #bae7ff;       /* Light Blue */
            --bg-accent: #91d5ff;         /* Medium Light Blue */
            --text-primary: #030852;       /* Deep Navy */
            --text-secondary: #0050b3;     /* Medium Blue */
            --text-accent: #061178;
            --primary-color: #1677ff;      /* Standard Blue */
            --primary-color-rgb: 22, 119, 255;
            --success-color: #08979c;      /* Teal */
            --success-color-rgb: 8, 151, 156;
            --danger-color: #cf1322;       /* Darker Red */
            --warning-color: #d48806;      /* Amber */
            --message-sent-bg: linear-gradient(135deg, #1677ff, #0958d9);
            --message-sent-text: #ffffff;
            --message-received-bg: #e6f4ff; /* Very Light Blue bg for received */
            --message-received-text: #030852;
            --link-color: #0958d9;
            --navbar-bg: #ffffff;
            --navbar-text: #030852;
            --navbar-border: #bae7ff;
            --sidebar-bg: #f0faff; /* Light blue tint */
            --sidebar-border: #bae7ff;
            --sidebar-header-bg: #e6f7ff;
            --avatar-placeholder-bg: #1677ff;
            --skeleton-bg: #bae7ff;
            --skeleton-shine-color: #e6f7ff;
        }


        /* Base HTML & Body Styles */
        html, body { height: 100%; overflow: hidden; }
        body {
            background-color: var(--bg-primary);
            color: var(--text-primary);
            font-family: "Inter", -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            font-size: 15px; /* Slightly smaller base */
            line-height: 1.6;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
            transition: background-color var(--transition-speed) ease, color var(--transition-speed) ease;
        }
        #app-container { display: flex; flex-direction: column; height: 100vh; }
        /* Custom Scrollbars */
        ::-webkit-scrollbar { width: 8px; height: 8px;}
        ::-webkit-scrollbar-track { background: transparent; }
        ::-webkit-scrollbar-thumb { background: var(--bg-accent); border-radius: 4px;}
        ::-webkit-scrollbar-thumb:hover { background: var(--text-secondary); }

        /* Skeleton Loading */
        .skeleton {
            background-color: var(--skeleton-bg);
            background-image: linear-gradient(90deg, var(--skeleton-bg), var(--skeleton-shine-color), var(--skeleton-bg));
            background-size: 200px 100%;
            background-repeat: no-repeat;
            border-radius: var(--border-radius-sm);
            display: inline-block;
            line-height: 1;
            width: 100%;
            height: 1em; /* Default height */
            animation: skeleton-shine 1.5s ease-in-out infinite;
            opacity: 0.7;
            vertical-align: middle;
        }
        .skeleton.skeleton-text { height: 0.8em; margin-bottom: 0.3em; }
        .skeleton.skeleton-title { height: 1.2em; margin-bottom: 0.5em; width: 60%; }
        .skeleton.skeleton-avatar { width: 40px; height: 40px; border-radius: 50%; }
        .skeleton.skeleton-button { height: 38px; width: 80px; }
        @keyframes skeleton-shine {
            0% { background-position: -200px 0; }
            100% { background-position: calc(200px + 100%) 0; }
        }
        .contact-list .skeleton-item { display: flex; align-items: center; padding: 0.75rem 1rem; border-bottom: 1px solid var(--sidebar-border); }
        .contact-list .skeleton-details { margin-left: 1rem; flex-grow: 1;}


        /*------------------------------------*\
          $AUTH SECTION STYLES
        \*------------------------------------*/
        #auth-section {
            /* ... (Largely same as previous refined version, maybe slightly different background) ... */
             display: flex; justify-content: center; align-items: center; flex-grow: 1; overflow-y: auto; padding: 2rem; background: var(--bg-primary);
        }
        #auth-section .card {
            max-width: 450px; width: 100%; background-color: var(--bg-secondary); border: 1px solid var(--bg-accent); box-shadow: var(--shadow-lg); border-radius: var(--border-radius-lg); transition: background-color var(--transition-speed) ease, border-color var(--transition-speed) ease; overflow: hidden;
        }
        #auth-section .card-body { padding: 2rem 2.5rem; }
        #auth-section .auth-icon { font-size: 3rem; margin-bottom: 0.5rem; color: var(--primary-color); }
        #auth-section .card-title { font-weight: 700; font-size: 1.5rem; color: var(--text-primary); margin-bottom: 0.25rem; }
        #auth-section .text-muted { color: var(--text-secondary) !important; margin-bottom: 1.75rem; font-size: 0.95rem; }
        #auth-section .nav-tabs { border-bottom-color: var(--bg-accent); }
        #auth-section .nav-link { color: var(--text-secondary); font-weight: 600; border-color: transparent !important; border-bottom-color: var(--bg-accent)!important; }
        #auth-section .nav-link.active { color: var(--primary-color); border-bottom: 2px solid var(--primary-color) !important; background: transparent !important; }
        #auth-section .form-label { font-weight: 500; color: var(--text-accent); margin-bottom: 0.3rem; font-size: 0.9rem; }
        #auth-section .form-control { background-color: var(--bg-primary); border: 1px solid var(--bg-accent); border-radius: var(--border-radius); padding: 0.6rem 1rem; font-size: 0.95rem; transition: border-color var(--transition-speed) ease, box-shadow var(--transition-speed) ease; }
        .theme-dark #auth-section .form-control { background-color: var(--bg-tertiary); } /* Dark override */
        #auth-section .form-control:focus { background-color: var(--bg-secondary); border-color: var(--primary-color); box-shadow: 0 0 0 0.2rem rgba(var(--primary-color-rgb), 0.15); outline: none; }
        #auth-section .btn { padding: 0.65rem 1rem; font-weight: 600; border-radius: var(--border-radius); }
        /* ... (Rest of auth styles, hr, switch links largely same as previous refined version) ... */
         #auth-section .social-login .btn { font-size: 0.9rem; padding: 0.5rem 1rem;}

        /*------------------------------------*\
          $CHAT SECTION STYLES
        \*------------------------------------*/
        #chat-section { display: flex; flex-grow: 1; overflow: hidden; background-color: var(--bg-primary); }

        /* Sidebar */
        #user-sidebar { /* ... (Largely same, potentially adjust width or bg slightly) ... */ width: 300px; background-color: var(--sidebar-bg); border-right: 1px solid var(--sidebar-border); }
        #sidebar-header { padding: 0.75rem 1rem; font-weight: 600; font-size: 0.9rem; border-bottom: 1px solid var(--sidebar-border); background-color: var(--sidebar-header-bg); color: var(--text-primary); }
        #user-list { padding: 0.25rem 0; } /* Reduced top/bottom padding */
        .user-list-item { /* ... (Mostly same) ... */ padding: 0.6rem 1rem; border-bottom: 1px solid var(--sidebar-border); }
        .user-list-item:last-child { border-bottom: none; }
        .user-list-item.active { background-color: var(--bg-tertiary); border-left: 3px solid var(--primary-color); padding-left: calc(1rem - 3px); } /* Active indicator */
        .user-list-item:hover { background-color: var(--bg-tertiary); }
        .user-list-item .avatar { width: 40px; height: 40px; }
        .user-list-item .online-indicator { width: 8px; height: 8px; }
        .contact-details { overflow: hidden; } /* Prevent text overflow issues */
        .last-message { font-size: 0.8rem; color: var(--text-secondary); max-width: 100%; }
        .message-meta { flex-shrink: 0; text-align: right; } /* Prevent shrinking */
        .message-time { font-size: 0.7rem; color: var(--text-secondary); }
        .unread-badge { background-color: var(--primary-color); color: white; font-size: 0.7rem; width: 18px; height: 18px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: 600; margin-top: 4px; }
        .search-box { padding: 0.75rem 1rem; }
        .search-input { border-radius: var(--border-radius-lg); background-color: var(--bg-tertiary); border-color: var(--bg-accent); font-size: 0.9rem; }
        .theme-dark .search-input { background-color: var(--bg-tertiary); }

        /* Main Chat Area */
        #chat-main { /* ... (Mostly same) ... */ background-color: var(--bg-secondary); }

        /* Chat Navbar */
        #chat-navbar { /* ... (Mostly same, maybe tweak padding/shadow) ... */ padding: 0.6rem 1.25rem; box-shadow: none; border-bottom: 1px solid var(--navbar-border); }
        .navbar-brand { color: var(--text-primary); }
        .navbar-brand i { color: var(--primary-color); }
        #chat-navbar .btn, #chat-navbar .dropdown-toggle { color: var(--text-secondary); border: none; }
        #chat-navbar .btn:hover, #chat-navbar .dropdown-toggle:hover { color: var(--text-primary); background-color: var(--bg-tertiary); }
        #chat-navbar .user-info .avatar { width: 36px; height: 36px; border: 2px solid var(--bg-accent); box-shadow: none; }
        #chat-navbar #user-display-name { font-weight: 600; font-size: 1rem; color: var(--text-primary); }
        #chat-navbar #logout-button .spinner-border { display: none; width: 1rem; height: 1rem; } /* Hide spinner by default */

        /* Chat Box & Messages */
        #chat-box-wrapper { /* ... (Same) ... */ }
        #chat-box { /* ... (Same) ... */ padding: 1rem 0.5rem 1rem 0; }
        .message-wrapper { /* ... (Same) ... */ }
        .message-avatar .avatar { width: 36px; height: 36px; }
        .message-bubble { padding: 0.65rem 1rem; border-radius: var(--border-radius-lg); }
        .message-wrapper.sent .message-bubble { border-bottom-right-radius: var(--border-radius-sm); background: var(--message-sent-bg); color: var(--message-sent-text); } /* Ensure theme applies */
        .message-wrapper.received .message-bubble { border-bottom-left-radius: var(--border-radius-sm); background-color: var(--message-received-bg); color: var(--message-received-text); } /* Ensure theme applies */
        .message-sender { font-size: 0.75rem; font-weight: 600; }
        .message-text { font-size: 0.95rem; }
        .message-timestamp { font-size: 0.65rem; }
        .media-message img, .media-message video { border-radius: var(--border-radius); cursor: pointer;}
        .audio-player audio { max-width: 250px; height: 40px;} /* Style audio player */

        /* Typing Indicator */
        #typing-indicator {
            bottom: 5px; /* Adjust position */
            padding: 0.25rem 0.75rem;
            background-color: rgba(var(--bg-secondary-rgb, 255, 255, 255), 0.8); /* Dynamic RGB needed */
            border: 1px solid var(--bg-accent);
             box-shadow: var(--shadow-sm);
        }
        /* ... (Need dynamic background based on theme) ... */
        body:not(.theme-dark) #typing-indicator { background-color: rgba(255, 255, 255, 0.9); }
        .theme-dark #typing-indicator { background-color: rgba(var(--bg-tertiary-rgb, 52, 58, 64), 0.9); border-color: var(--bg-accent);} /* Dark theme bg */
        .theme-sapphire #typing-indicator { background-color: rgba(255, 255, 255, 0.9); }


        /* Message Input */
        #message-form-container { padding: 0.75rem 1.25rem; box-shadow: none; border-top: 1px solid var(--bg-accent);}
        #message-input { border-radius: var(--border-radius-lg); padding: 0.6rem 1.1rem; font-size: 0.95rem; }
        #send-button { width: 44px; height: 44px; }
        #send-button .bi-send-fill { font-size: 1.1rem; }
        .message-actions .action-btn { width: 40px; height: 40px; color: var(--text-secondary); background: transparent;}
        .message-actions .action-btn:hover { background-color: var(--bg-tertiary); color: var(--text-primary);}

        /* Emoji Picker */
        #emojiPicker { background-color: var(--bg-secondary); border: 1px solid var(--bg-accent); box-shadow: var(--shadow); border-radius: var(--border-radius); bottom: 65px; right: 15px; }
        #emojiPicker .emoji { font-size: 1.4rem; }
        #emojiPicker .emoji:hover { background-color: var(--bg-tertiary); }


        /*------------------------------------*\
          $MODALS & UTILITIES
        \*------------------------------------*/
        .modal-content { background-color: var(--bg-secondary); border: none; border-radius: var(--border-radius-lg); box-shadow: var(--shadow-lg); }
        .modal-header { border-bottom-color: var(--bg-accent); }
        .modal-footer { border-top-color: var(--bg-accent); background-color: var(--bg-primary); }
        /* Profile Modal Enhancements */
        #profileModal .profile-pic { width: 120px; height: 120px; font-size: 3rem; border: 3px solid var(--bg-secondary); box-shadow: 0 0 0 4px var(--primary-color); }
        #profileModal #editProfilePic { /* Style the smaller pic inside */ }

        /* Toast Notifications */
        .toast-container { position: fixed; bottom: 1.5rem; right: 1.5rem; z-index: 1100; }
        .toast { border-radius: var(--border-radius); box-shadow: var(--shadow-lg); }
        .toast-header { border-bottom-color: rgba(0,0,0,0.05); }
        .toast.bg-success { background-color: var(--success-color) !important; color: var(--primary-text);}
         .toast.bg-danger { background-color: var(--danger-color) !important; color: var(--danger-text);}
         .toast.bg-info { background-color: var(--primary-color) !important; color: var(--primary-text);}


        /* Loading Overlay */
        #loading-overlay { /* ... (Same as previous) ... */ background-color: rgba(var(--bg-primary-rgb, 241, 243, 245), 0.85); z-index: 2000; backdrop-filter: blur(2px); }
        body:not(.theme-dark):not(.theme-sapphire) #loading-overlay { background-color: rgba(241, 243, 245, 0.85); }
        .theme-dark #loading-overlay { background-color: rgba(26, 29, 33, 0.85); }
        .theme-sapphire #loading-overlay { background-color: rgba(230, 247, 255, 0.85); }


        /* Responsive */
        @media (max-width: 991.98px) {
            #user-sidebar { width: 260px; }
        }
        @media (max-width: 767.98px) {
            /* ... (Sidebar becomes fixed/offcanvas as before) ... */
            #user-sidebar { position: fixed; left: -305px; width: 300px; height: 100%; z-index: 1045; }
             #user-sidebar.active { left: 0; box-shadow: var(--shadow-lg); }
             #sidebar-toggle-button { display: inline-flex !important; }
             #chat-main { width: 100%; } /* Ensure main area takes full width when sidebar hidden */
        }
