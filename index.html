<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>AppHub - Professional App Store</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
      color: #333;
    }

    .container {
      max-width: 1200px;
      margin: 0 auto;
      padding: 20px;
    }

    .header {
      background: rgba(255, 255, 255, 0.95);
      backdrop-filter: blur(10px);
      border-radius: 20px;
      padding: 20px;
      margin-bottom: 30px;
      box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
      display: flex;
      justify-content: space-between;
      align-items: center;
      flex-wrap: wrap;
      gap: 20px;
    }

    .logo {
      font-size: 2rem;
      font-weight: bold;
      background: linear-gradient(45deg, #667eea, #764ba2);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }

    .auth-section {
      display: flex;
      gap: 10px;
      align-items: center;
    }

    .btn {
      padding: 12px 24px;
      border: none;
      border-radius: 12px;
      cursor: pointer;
      font-weight: 600;
      transition: all 0.3s ease;
      text-decoration: none;
      display: inline-block;
      text-align: center;
    }

    .btn-primary {
      background: linear-gradient(45deg, #667eea, #764ba2);
      color: white;
    }

    .btn-secondary {
      background: rgba(102, 126, 234, 0.1);
      color: #667eea;
      border: 2px solid #667eea;
    }

    .btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
    }

    .tabs {
      background: rgba(255, 255, 255, 0.95);
      backdrop-filter: blur(10px);
      border-radius: 20px;
      padding: 20px;
      margin-bottom: 30px;
      box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
    }

    .tab-buttons {
      display: flex;
      gap: 10px;
      margin-bottom: 20px;
      flex-wrap: wrap;
    }

    .tab-btn {
      padding: 12px 24px;
      border: none;
      border-radius: 12px;
      cursor: pointer;
      background: rgba(102, 126, 234, 0.1);
      color: #667eea;
      font-weight: 600;
      transition: all 0.3s ease;
    }

    .tab-btn.active {
      background: linear-gradient(45deg, #667eea, #764ba2);
      color: white;
    }

    .tab-content {
      display: none;
    }

    .tab-content.active {
      display: block;
    }

    .filters {
      display: flex;
      gap: 15px;
      margin-bottom: 20px;
      flex-wrap: wrap;
      align-items: center;
    }

    .search-bar {
      flex: 1;
      min-width: 250px;
      padding: 12px 20px;
      border: 2px solid #e0e0e0;
      border-radius: 12px;
      font-size: 16px;
      transition: border-color 0.3s ease;
    }

    .search-bar:focus {
      outline: none;
      border-color: #667eea;
    }

    .category-filter {
      padding: 12px 20px;
      border: 2px solid #e0e0e0;
      border-radius: 12px;
      background: white;
      cursor: pointer;
    }

    .apps-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
      gap: 20px;
      margin-top: 20px;
    }

    .app-card {
      background: rgba(255, 255, 255, 0.95);
      backdrop-filter: blur(10px);
      border-radius: 20px;
      padding: 20px;
      box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
      transition: all 0.3s ease;
      cursor: pointer;
    }

    .app-card:hover {
      transform: translateY(-4px);
      box-shadow: 0 12px 40px rgba(0, 0, 0, 0.15);
    }

    .app-header {
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      margin-bottom: 15px;
    }

    .app-icon {
      width: 60px;
      height: 60px;
      border-radius: 15px;
      background: linear-gradient(45deg, #667eea, #764ba2);
      display: flex;
      align-items: center;
      justify-content: center;
      color: white;
      font-size: 24px;
      font-weight: bold;
    }

    .app-meta {
      flex: 1;
      margin-left: 15px;
    }

    .app-title {
      font-size: 1.2rem;
      font-weight: bold;
      margin-bottom: 5px;
      color: #333;
    }

    .app-developer {
      color: #666;
      font-size: 0.9rem;
    }

    .app-rating {
      display: flex;
      align-items: center;
      gap: 5px;
      margin-top: 5px;
    }

    .stars {
      color: #ffd700;
    }

    .app-description {
      color: #666;
      line-height: 1.5;
      margin-bottom: 15px;
    }

    .app-tags {
      display: flex;
      gap: 8px;
      margin-bottom: 15px;
      flex-wrap: wrap;
    }

    .tag {
      background: rgba(102, 126, 234, 0.1);
      color: #667eea;
      padding: 4px 12px;
      border-radius: 20px;
      font-size: 0.8rem;
      font-weight: 500;
    }

    .app-actions {
      display: flex;
      gap: 10px;
      align-items: center;
    }

    .download-count {
      color: #666;
      font-size: 0.9rem;
      margin-left: auto;
    }

    .modal {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.5);
      backdrop-filter: blur(5px);
      z-index: 1000;
    }

    .modal-content {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background: white;
      border-radius: 20px;
      padding: 30px;
      max-width: 500px;
      width: 90%;
      max-height: 80vh;
      overflow-y: auto;
    }

    .form-group {
      margin-bottom: 20px;
    }

    .form-group label {
      display: block;
      margin-bottom: 5px;
      font-weight: 600;
      color: #333;
    }

    .form-group input,
    .form-group textarea,
    .form-group select {
      width: 100%;
      padding: 12px;
      border: 2px solid #e0e0e0;
      border-radius: 12px;
      font-size: 16px;
      transition: border-color 0.3s ease;
    }

    .form-group input:focus,
    .form-group textarea:focus,
    .form-group select:focus {
      outline: none;
      border-color: #667eea;
    }

    .upload-area {
      border: 2px dashed #667eea;
      border-radius: 12px;
      padding: 40px;
      text-align: center;
      cursor: pointer;
      transition: all 0.3s ease;
    }

    .upload-area:hover {
      background: rgba(102, 126, 234, 0.05);
    }

    .upload-area.dragover {
      background: rgba(102, 126, 234, 0.1);
      border-color: #764ba2;
    }

    .status-message {
      padding: 12px;
      border-radius: 12px;
      margin-bottom: 20px;
      font-weight: 500;
    }

    .status-success {
      background: #d4edda;
      color: #155724;
      border: 1px solid #c3e6cb;
    }

    .status-error {
      background: #f8d7da;
      color: #721c24;
      border: 1px solid #f5c6cb;
    }

    .user-profile {
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .user-avatar {
      width: 40px;
      height: 40px;
      border-radius: 50%;
      background: linear-gradient(45deg, #667eea, #764ba2);
      display: flex;
      align-items: center;
      justify-content: center;
      color: white;
      font-weight: bold;
    }

    .close-modal {
      position: absolute;
      top: 15px;
      right: 15px;
      background: none;
      border: none;
      font-size: 24px;
      cursor: pointer;
      color: #666;
    }

    .analytics-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 20px;
      margin-bottom: 30px;
    }

    .analytics-card {
      background: rgba(255, 255, 255, 0.95);
      backdrop-filter: blur(10px);
      border-radius: 20px;
      padding: 20px;
      box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
      text-align: center;
    }

    .analytics-number {
      font-size: 2rem;
      font-weight: bold;
      color: #667eea;
      margin-bottom: 5px;
    }

    .analytics-label {
      color: #666;
      font-size: 0.9rem;
    }

    @media (max-width: 768px) {
      .container {
        padding: 10px;
      }
      
      .header {
        flex-direction: column;
        text-align: center;
      }
      
      .filters {
        flex-direction: column;
        align-items: stretch;
      }
      
      .apps-grid {
        grid-template-columns: 1fr;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <!-- Header -->
    <div class="header">
      <div class="logo">üöÄ AppHub</div>
      <div class="auth-section">
        <div id="userSection" style="display: none;">
          <div class="user-profile">
            <div class="user-avatar" id="userAvatar"></div>
            <span id="userName"></span>
            <button class="btn btn-secondary" onclick="signOut()">Sign Out</button>
          </div>
        </div>
        <div id="authSection">
          <button class="btn btn-secondary" onclick="showAuthModal()">Sign In</button>
          <button class="btn btn-primary" onclick="showUploadModal()">Upload App</button>
        </div>
      </div>
    </div>

    <!-- Tabs -->
    <div class="tabs">
      <div class="tab-buttons">
        <button class="tab-btn active" onclick="switchTab('discover')">üîç Discover</button>
        <button class="tab-btn" onclick="switchTab('myapps')" id="myAppsTab" style="display: none;">üì± My Apps</button>
        <button class="tab-btn" onclick="switchTab('analytics')" id="analyticsTab" style="display: none;">üìä Analytics</button>
      </div>

      <!-- Discover Tab -->
      <div class="tab-content active" id="discover">
        <div class="filters">
          <input type="text" class="search-bar" placeholder="üîç Search apps..." id="searchInput">
          <select class="category-filter" id="categoryFilter">
            <option value="">All Categories</option>
            <option value="productivity">Productivity</option>
            <option value="games">Games</option>
            <option value="education">Education</option>
            <option value="utilities">Utilities</option>
            <option value="entertainment">Entertainment</option>
            <option value="business">Business</option>
          </select>
          <select class="category-filter" id="sortFilter">
            <option value="newest">Newest First</option>
            <option value="popular">Most Popular</option>
            <option value="rating">Highest Rated</option>
          </select>
        </div>
        <div class="apps-grid" id="appsGrid"></div>
      </div>

      <!-- My Apps Tab -->
      <div class="tab-content" id="myapps">
        <div class="analytics-grid">
          <div class="analytics-card">
            <div class="analytics-number" id="totalApps">0</div>
            <div class="analytics-label">Total Apps</div>
          </div>
          <div class="analytics-card">
            <div class="analytics-number" id="totalDownloads">0</div>
            <div class="analytics-label">Total Downloads</div>
          </div>
          <div class="analytics-card">
            <div class="analytics-number" id="avgRating">0.0</div>
            <div class="analytics-label">Average Rating</div>
          </div>
        </div>
        <div class="apps-grid" id="myAppsGrid"></div>
      </div>

      <!-- Analytics Tab -->
      <div class="tab-content" id="analytics">
        <div class="analytics-grid">
          <div class="analytics-card">
            <div class="analytics-number" id="platformApps">0</div>
            <div class="analytics-label">Platform Apps</div>
          </div>
          <div class="analytics-card">
            <div class="analytics-number" id="activeUsers">0</div>
            <div class="analytics-label">Active Developers</div>
          </div>
          <div class="analytics-card">
            <div class="analytics-number" id="platformDownloads">0</div>
            <div class="analytics-label">Platform Downloads</div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Auth Modal -->
  <div class="modal" id="authModal">
    <div class="modal-content">
      <button class="close-modal" onclick="closeModal('authModal')">&times;</button>
      <h2>Sign In to AppHub</h2>
      <div class="form-group">
        <label>Email</label>
        <input type="email" id="authEmail" placeholder="Enter your email">
      </div>
      <div class="form-group">
        <label>Password</label>
        <input type="password" id="authPassword" placeholder="Enter your password">
      </div>
      <div class="form-group">
        <button class="btn btn-primary" onclick="signIn()">Sign In</button>
        <button class="btn btn-secondary" onclick="signUp()">Create Account</button>
      </div>
      <div id="authStatus"></div>
    </div>
  </div>

  <!-- Upload Modal -->
  <div class="modal" id="uploadModal">
    <div class="modal-content">
      <button class="close-modal" onclick="closeModal('uploadModal')">&times;</button>
      <h2>Upload New App</h2>
      <form id="uploadForm">
        <div class="form-group">
          <label>App Name *</label>
          <input type="text" id="appName" required>
        </div>
        <div class="form-group">
          <label>Description *</label>
          <textarea id="appDescription" rows="4" required></textarea>
        </div>
        <div class="form-group">
          <label>Category *</label>
          <select id="appCategory" required>
            <option value="">Select Category</option>
            <option value="productivity">Productivity</option>
            <option value="games">Games</option>
            <option value="education">Education</option>
            <option value="utilities">Utilities</option>
            <option value="entertainment">Entertainment</option>
            <option value="business">Business</option>
          </select>
        </div>
        <div class="form-group">
          <label>Version</label>
          <input type="text" id="appVersion" placeholder="1.0.0">
        </div>
        <div class="form-group">
          <label>App File *</label>
          <div class="upload-area" id="uploadArea">
            <div>üì± Click or drag to upload your app file</div>
            <div style="font-size: 0.9rem; color: #666; margin-top: 10px;">
              Supported: .zip, .apk, .ipa (Max: 50MB)
            </div>
          </div>
          <input type="file" id="appFile" accept=".zip,.apk,.ipa" style="display: none;">
        </div>
        <div class="form-group">
          <button type="submit" class="btn btn-primary">Upload App</button>
        </div>
      </form>
      <div id="uploadStatus"></div>
    </div>
  </div>

  <!-- Firebase -->
  <script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-storage-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore-compat.js"></script>

  <script>
    // Firebase Configuration
    const firebaseConfig = {
      apiKey: "AIzaSyAIoQljzzHrBCx9s-Sm5VPc0sMeQ443OW0",
      authDomain: "deutshlibrary.firebaseapp.com",
      projectId: "deutshlibrary",
      storageBucket: "deutshlibrary.appspot.com",
      messagingSenderId: "70726183376",
      appId: "1:70726183376:web:94daba35d5d68666dbb1d5",
      measurementId: "G-DWSDR2Y63K"
    };

    // Initialize Firebase
    firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();
    const storage = firebase.storage();
    const db = firebase.firestore();

    // Global variables
    let currentUser = null;
    let allApps = [];
    let filteredApps = [];

    // Authentication state observer
    auth.onAuthStateChanged((user) => {
      currentUser = user;
      updateAuthUI();
      if (user) {
        loadMyApps();
        loadAnalytics();
      }
    });

    // Update authentication UI
    function updateAuthUI() {
      const userSection = document.getElementById('userSection');
      const authSection = document.getElementById('authSection');
      const myAppsTab = document.getElementById('myAppsTab');
      const analyticsTab = document.getElementById('analyticsTab');

      if (currentUser) {
        userSection.style.display = 'block';
        authSection.style.display = 'none';
        myAppsTab.style.display = 'block';
        analyticsTab.style.display = 'block';
        
        document.getElementById('userName').textContent = currentUser.email;
        document.getElementById('userAvatar').textContent = currentUser.email.charAt(0).toUpperCase();
      } else {
        userSection.style.display = 'none';
        authSection.style.display = 'block';
        myAppsTab.style.display = 'none';
        analyticsTab.style.display = 'none';
      }
    }

    // Tab switching
    function switchTab(tabName) {
      document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active'));
      document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
      
      event.target.classList.add('active');
      document.getElementById(tabName).classList.add('active');

      if (tabName === 'myapps') {
        loadMyApps();
      } else if (tabName === 'analytics') {
        loadAnalytics();
      }
    }

    // Modal functions
    function showAuthModal() {
      document.getElementById('authModal').style.display = 'block';
    }

    function showUploadModal() {
      if (!currentUser) {
        showAuthModal();
        return;
      }
      document.getElementById('uploadModal').style.display = 'block';
    }

    function closeModal(modalId) {
      document.getElementById(modalId).style.display = 'none';
    }

    // Authentication functions
    async function signIn() {
      const email = document.getElementById('authEmail').value;
      const password = document.getElementById('authPassword').value;
      const status = document.getElementById('authStatus');

      try {
        await auth.signInWithEmailAndPassword(email, password);
        closeModal('authModal');
        showStatus('authStatus', 'Sign in successful!', 'success');
      } catch (error) {
        showStatus('authStatus', error.message, 'error');
      }
    }

    async function signUp() {
      const email = document.getElementById('authEmail').value;
      const password = document.getElementById('authPassword').value;
      const status = document.getElementById('authStatus');

      try {
        await auth.createUserWithEmailAndPassword(email, password);
        closeModal('authModal');
        showStatus('authStatus', 'Account created successfully!', 'success');
      } catch (error) {
        showStatus('authStatus', error.message, 'error');
      }
    }

    function signOut() {
      auth.signOut();
    }

    // Upload functionality
    document.getElementById('uploadArea').addEventListener('click', () => {
      document.getElementById('appFile').click();
    });

    document.getElementById('appFile').addEventListener('change', (e) => {
      const file = e.target.files[0];
      if (file) {
        document.querySelector('.upload-area div').textContent = `Selected: ${file.name}`;
      }
    });

    // Drag and drop
    const uploadArea = document.getElementById('uploadArea');
    uploadArea.addEventListener('dragover', (e) => {
      e.preventDefault();
      uploadArea.classList.add('dragover');
    });

    uploadArea.addEventListener('dragleave', () => {
      uploadArea.classList.remove('dragover');
    });

    uploadArea.addEventListener('drop', (e) => {
      e.preventDefault();
      uploadArea.classList.remove('dragover');
      const file = e.dataTransfer.files[0];
      if (file) {
        document.getElementById('appFile').files = e.dataTransfer.files;
        document.querySelector('.upload-area div').textContent = `Selected: ${file.name}`;
      }
    });

    // Upload form submission
    document.getElementById('uploadForm').addEventListener('submit', async (e) => {
      e.preventDefault();
      
      const name = document.getElementById('appName').value;
      const description = document.getElementById('appDescription').value;
      const category = document.getElementById('appCategory').value;
      const version = document.getElementById('appVersion').value || '1.0.0';
      const file = document.getElementById('appFile').files[0];

      if (!file) {
        showStatus('uploadStatus', 'Please select a file to upload.', 'error');
        return;
      }

      if (file.size > 50 * 1024 * 1024) {
        showStatus('uploadStatus', 'File size must be less than 50MB.', 'error');
        return;
      }

      try {
        showStatus('uploadStatus', 'Uploading app...', 'success');
        
        // Upload file to Firebase Storage
        const fileRef = storage.ref().child(`apps/${currentUser.uid}/${Date.now()}_${file.name}`);
        const uploadTask = fileRef.put(file);
        
        uploadTask.on('state_changed', 
          (snapshot) => {
            const progress = (snapshot.bytesTransferred / snapshot.totalBytes) * 100;
            showStatus('uploadStatus', `Upload progress: ${progress.toFixed(1)}%`, 'success');
          }
        );

        await uploadTask;
        const downloadURL = await fileRef.getDownloadURL();

        // Save app metadata to Firestore
        await db.collection('apps').add({
          name,
          description,
          category,
          version,
          downloadURL,
          fileName: file.name,
          fileSize: file.size,
          developerEmail: currentUser.email,
          developerId: currentUser.uid,
          createdAt: firebase.firestore.FieldValue.serverTimestamp(),
          updatedAt: firebase.firestore.FieldValue.serverTimestamp(),
          downloads: 0,
          rating: 0,
          ratingCount: 0,
          featured: false,
          status: 'active'
        });

        showStatus('uploadStatus', 'App uploaded successfully!', 'success');
        document.getElementById('uploadForm').reset();
        document.querySelector('.upload-area div').textContent = 'üì± Click or drag to upload your app file';
        
        setTimeout(() => {
          closeModal('uploadModal');
          loadApps();
          if (document.getElementById('myapps').classList.contains('active')) {
            loadMyApps();
          }
        }, 2000);

      } catch (error) {
        console.error('Upload error:', error);
        showStatus('uploadStatus', 'Upload failed: ' + error.message, 'error');
      }
    });

    // Load apps
    async function loadApps() {
      try {
        const snapshot = await db.collection('apps')
          .where('status', '==', 'active')
          .orderBy('createdAt', 'desc')
          .get();

        allApps = [];
        snapshot.forEach(doc => {
          allApps.push({ id: doc.id, ...doc.data() });
        });

        filteredApps = [...allApps];
        displayApps();
      } catch (error) {
        console.error('Error loading apps:', error);
      }
    }

    // Display apps
    function displayApps() {
      const grid = document.getElementById('appsGrid');
      grid.innerHTML = '';

      if (filteredApps.length === 0) {
        grid.innerHTML = '<div style="text-align: center; grid-column: 1 / -1; padding: 40px; color: #666;">No apps found matching your criteria.</div>';
        return;
      }

      filteredApps.forEach(app => {
        const appCard = createAppCard(app);
        grid.appendChild(appCard);
      });
    }

    // Create app card
    function createAppCard(app) {
      const card = document.createElement('div');
      card.className = 'app-card';
      
      const stars = '‚òÖ'.repeat(Math.floor(app.rating || 0)) + '‚òÜ'.repeat(5 - Math.floor(app.rating || 0));
      const icon = app.name.charAt(0).toUpperCase();
      
      card.innerHTML = `
        <div class="app-header">
          <div class="app-icon">${icon}</div>
          <div class="app-meta">
            <div class="app-title">${app.name}</div>
            <div class="app-developer">${app.developerEmail}</div>
            <div class="app-rating">
              <span class="stars">${stars}</span>
              <span>(${app.ratingCount || 0})</span>
            </div>
          </div>
        </div>
        <div class="app-description">${app.description}</div>
        <div class="app-tags">
          <span class="tag">${app.category}</span>
          <span class="tag">v${app.version}</span>
        </div>
        <div class="app-actions">
          <button class="btn btn-primary" onclick="downloadApp('${app.id}', '${app.downloadURL}', '${app.fileName}')">
            ‚¨á Download
          </button>
          <div class="download-count">${app.downloads || 0} downloads</div>
        </div>
      `;
      
      return card;
    }

    // Download app
    async function downloadApp(appId, downloadURL, fileName) {
      try {
        // Increment download count
        await db.collection('apps').doc(appId).update({
          downloads: firebase.firestore.FieldValue.increment(1)
        });

        // Create download link
        const link = document.createElement('a');
        link.href = downloadURL;
        link.download = fileName;
        link.click();

        // Refresh display
        loadApps();
      } catch (error) {
        console.error('Download error:', error);
      }
    }

    // Load my apps
    async function loadMyApps() {
      if (!currentUser) return;

      try {
        const snapshot = await db.collection('apps')
          .where('developerId', '==', currentUser.uid)
          .orderBy('createdAt', 'desc')
          .get();

        const myApps = [];
        let totalDownloads = 0;
        let totalRatings = 0;
        let ratingCount = 0;

        snapshot.forEach(doc => {
          const app = { id: doc.id, ...doc.data() };
          myApps.push(app);
          totalDownloads += app.downloads || 0;
          if (app.rating && app.ratingCount) {
            totalRatings += app.rating * app.ratingCount;
            ratingCount += app.ratingCount;
          }
        });

        // Update analytics
        document.getElementById('totalApps').textContent = myApps.length;
        document.getElementById('totalDownloads').textContent = totalDownloads;
        document.getElementById('avgRating').textContent = ratingCount > 0 ? (totalRatings / ratingCount).toFixed(1) : '0.0';

        // Display apps
        const grid = document.getElementById('myAppsGrid');
        grid.innerHTML = '';

        if (myApps.length === 0) {
          grid.innerHTML = '<div style="text-align: center; grid-column: 1 / -1; padding: 40px; color: #666;">You haven\'t uploaded any apps yet. <a href="#" onclick="showUploadModal()" style="color: #667eea;">Upload your first app!</a></div>';
          return;
        }

        myApps.forEach(app => {
          const appCard = createMyAppCard(app);
          grid.appendChild(appCard);
        });

      } catch (error) {
        console.error('Error loading my apps:', error);
      }
    }

    // Create my app card with management options
    function createMyAppCard(app) {
      const card = document.createElement('div');
      card.className = 'app-card';
      
      const stars = '‚òÖ'.repeat(Math.floor(app.rating || 0)) + '‚òÜ'.repeat(5 - Math.floor(app.rating || 0));
      const icon = app.name.charAt(0).toUpperCase();
      const status = app.status === 'active' ? 'üü¢' : 'üî¥';
      
      card.innerHTML = `
        <div class="app-header">
          <div class="app-icon">${icon}</div>
          <div class="app-meta">
            <div class="app-title">${app.name} ${status}</div>
            <div class="app-developer">Created: ${app.createdAt ? new Date(app.createdAt.toDate()).toLocaleDateString() : 'Unknown'}</div>
            <div class="app-rating">
              <span class="stars">${stars}</span>
              <span>(${app.ratingCount || 0} reviews)</span>
            </div>
          </div>
        </div>
        <div class="app-description">${app.description}</div>
        <div class="app-tags">
          <span class="tag">${app.category}</span>
          <span class="tag">v${app.version}</span>
          <span class="tag">${formatFileSize(app.fileSize)}</span>
        </div>
        <div class="app-actions">
          <button class="btn btn-secondary" onclick="editApp('${app.id}')">‚úèÔ∏è Edit</button>
          <button class="btn btn-secondary" onclick="toggleAppStatus('${app.id}', '${app.status}')">
            ${app.status === 'active' ? '‚è∏Ô∏è Disable' : '‚ñ∂Ô∏è Enable'}
          </button>
          <div class="download-count">${app.downloads || 0} downloads</div>
        </div>
      `;
      
      return card;
    }

    // Format file size
    function formatFileSize(bytes) {
      if (!bytes) return '0 B';
      const k = 1024;
      const sizes = ['B', 'KB', 'MB', 'GB'];
      const i = Math.floor(Math.log(bytes) / Math.log(k));
      return parseFloat((bytes / Math.pow(k, i)).toFixed(1)) + ' ' + sizes[i];
    }

    // Toggle app status
    async function toggleAppStatus(appId, currentStatus) {
      const newStatus = currentStatus === 'active' ? 'disabled' : 'active';
      
      try {
        await db.collection('apps').doc(appId).update({
          status: newStatus,
          updatedAt: firebase.firestore.FieldValue.serverTimestamp()
        });
        
        loadMyApps();
        loadApps(); // Refresh main apps list
      } catch (error) {
        console.error('Error updating app status:', error);
      }
    }

    // Edit app (placeholder function)
    function editApp(appId) {
      alert('Edit functionality coming soon!');
    }

    // Load platform analytics
    async function loadAnalytics() {
      try {
        const appsSnapshot = await db.collection('apps').get();
        const usersSnapshot = await db.collection('apps').get();
        
        let totalDownloads = 0;
        const developers = new Set();
        
        appsSnapshot.forEach(doc => {
          const app = doc.data();
          totalDownloads += app.downloads || 0;
          developers.add(app.developerId);
        });

        document.getElementById('platformApps').textContent = appsSnapshot.size;
        document.getElementById('activeUsers').textContent = developers.size;
        document.getElementById('platformDownloads').textContent = totalDownloads;
        
      } catch (error) {
        console.error('Error loading analytics:', error);
      }
    }

    // Search and filter functionality
    document.getElementById('searchInput').addEventListener('input', filterApps);
    document.getElementById('categoryFilter').addEventListener('change', filterApps);
    document.getElementById('sortFilter').addEventListener('change', filterApps);

    function filterApps() {
      const searchTerm = document.getElementById('searchInput').value.toLowerCase();
      const category = document.getElementById('categoryFilter').value;
      const sortBy = document.getElementById('sortFilter').value;

      // Filter apps
      filteredApps = allApps.filter(app => {
        const matchesSearch = app.name.toLowerCase().includes(searchTerm) || 
                            app.description.toLowerCase().includes(searchTerm) ||
                            app.developerEmail.toLowerCase().includes(searchTerm);
        const matchesCategory = !category || app.category === category;
        
        return matchesSearch && matchesCategory;
      });

      // Sort apps
      switch (sortBy) {
        case 'popular':
          filteredApps.sort((a, b) => (b.downloads || 0) - (a.downloads || 0));
          break;
        case 'rating':
          filteredApps.sort((a, b) => (b.rating || 0) - (a.rating || 0));
          break;
        case 'newest':
        default:
          filteredApps.sort((a, b) => {
            const timeA = a.createdAt ? a.createdAt.toDate() : new Date(0);
            const timeB = b.createdAt ? b.createdAt.toDate() : new Date(0);
            return timeB - timeA;
          });
          break;
      }

      displayApps();
    }

    // Utility function to show status messages
    function showStatus(elementId, message, type) {
      const element = document.getElementById(elementId);
      element.innerHTML = `<div class="status-message status-${type}">${message}</div>`;
      
      if (type === 'success') {
        setTimeout(() => {
          element.innerHTML = '';
        }, 3000);
      }
    }

    // Close modals when clicking outside
    window.addEventListener('click', (e) => {
      if (e.target.classList.contains('modal')) {
        e.target.style.display = 'none';
      }
    });

    // Initialize app
    document.addEventListener('DOMContentLoaded', () => {
      loadApps();
    });

    // Add some demo data for testing (remove in production)
    async function addDemoData() {
      if (!currentUser) return;
      
      const demoApps = [
        {
          name: "TaskMaster Pro",
          description: "A powerful task management app with advanced features for productivity enthusiasts. Organize your work, set priorities, and track progress.",
          category: "productivity",
          version: "2.1.0",
          downloadURL: "https://example.com/taskmaster.zip",
          fileName: "taskmaster-pro.zip",
          fileSize: 15728640, // 15MB
          developerEmail: "demo@example.com",
          developerId: "demo-user-1",
          downloads: 1250,
          rating: 4.5,
          ratingCount: 89,
          featured: true,
          status: "active"
        },
        {
          name: "Pixel Adventure",
          description: "An exciting retro-style platformer game with challenging levels and beautiful pixel art. Perfect for gamers of all ages.",
          category: "games",
          version: "1.3.2",
          downloadURL: "https://example.com/pixel-adventure.zip",
          fileName: "pixel-adventure.zip",
          fileSize: 32505856, // 31MB
          developerEmail: "gamedev@example.com",
          developerId: "demo-user-2",
          downloads: 2100,
          rating: 4.8,
          ratingCount: 156,
          featured: false,
          status: "active"
        },
        {
          name: "Learn Spanish",
          description: "Interactive language learning app with voice recognition and gamified lessons. Master Spanish with daily practice.",
          category: "education",
          version: "3.0.1",
          downloadURL: "https://example.com/learn-spanish.zip",
          fileName: "learn-spanish.zip",
          fileSize: 28311552, // 27MB
          developerEmail: "edutech@example.com",
          developerId: "demo-user-3",
          downloads: 890,
          rating: 4.2,
          ratingCount: 67,
          featured: false,
          status: "active"
        }
      ];

      try {
        for (const app of demoApps) {
          await db.collection('apps').add({
            ...app,
            createdAt: firebase.firestore.FieldValue.serverTimestamp(),
            updatedAt: firebase.firestore.FieldValue.serverTimestamp()
          });
        }
        console.log('Demo data added successfully');
        loadApps();
      } catch (error) {
        console.error('Error adding demo data:', error);
      }
    }

    // Uncomment the line below to add demo data (for testing purposes)
    // setTimeout(addDemoData, 2000);
  </script>
</body>
</html>
