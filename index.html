<!doctype html>
<html lang="fr">

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>Plateforme d'Apprentissage FPN — Université Mohamed Premier</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/chart.js@4.4.4/dist/chart.min.css" rel="stylesheet">

    <style>
        /* ============================
   GLOBAL THEME VARIABLES
   ============================ */
:root {
    --brand: #0b3b61;
    --accent: #d4af37;
    --muted: #6c757d;
    --surface: #ffffff;
    --soft: #f8f9fa;
    --text: #111827;
    --border: #e5e7eb;
    --success: #10b981;
    --danger: #ef4444;
    --warning: #f59e0b;
    --info: #3b82f6;
    --light-bg: #f8f9fa;
    --dark-bg: #0f172a;
    --dark-text: #f1f5f9;
    --dark-surface: #1e293b;
    --dark-border: #334155;
    --radius-sm: 8px;
    --radius-md: 12px;
    --radius-lg: 16px;
    --shadow-sm: 0 1px 3px rgba(0, 0, 0, 0.08);
    --shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
    --shadow-md: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
    --shadow-lg: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
    --shadow-xl: 0 25px 50px -12px rgba(0, 0, 0, 0.25);
    --transition-fast: 150ms cubic-bezier(0.4, 0, 0.2, 1);
    --transition-base: 250ms cubic-bezier(0.4, 0, 0.2, 1);
    --transition-slow: 350ms cubic-bezier(0.4, 0, 0.2, 1);
    --backdrop-blur: blur(12px);
}

/* ============================
   BASE STYLES
   ============================ */
*,
*::before,
*::after {
    box-sizing: border-box;
    margin: 0;
    padding: 0;
}

html {
    font-size: 16px;
    -webkit-font-smoothing: antialiased;
    -moz-osx-font-smoothing: grayscale;
}

html,
body {
    height: 100%;
    margin: 0;
    padding: 0;
    background: var(--soft);
    color: var(--text);
    font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
    transition: background var(--transition-base), color var(--transition-base);
    overflow-x: hidden;
    scroll-behavior: smooth;
}

a {
    color: var(--brand);
    text-decoration: none;
    transition: color var(--transition-fast);
}

a:hover {
    color: var(--accent);
}

a:focus-visible {
    outline: 2px solid var(--accent);
    outline-offset: 2px;
    border-radius: 4px;
}

button,
.btn {
    transition: all var(--transition-fast);
}

button:focus-visible,
.btn:focus-visible {
    outline: 2px solid var(--accent);
    outline-offset: 2px;
}

/* ============================
   SCROLLBAR STYLING
   ============================ */
::-webkit-scrollbar {
    width: 10px;
    height: 10px;
}

::-webkit-scrollbar-track {
    background: var(--soft);
}

::-webkit-scrollbar-thumb {
    background: var(--border);
    border-radius: 5px;
    transition: background var(--transition-fast);
}

::-webkit-scrollbar-thumb:hover {
    background: var(--muted);
}

[data-theme="dark"] ::-webkit-scrollbar-track {
    background: var(--dark-bg);
}

[data-theme="dark"] ::-webkit-scrollbar-thumb {
    background: var(--dark-border);
}

[data-theme="dark"] ::-webkit-scrollbar-thumb:hover {
    background: var(--muted);
}

/* ============================
   THEMES
   ============================ */
[data-theme="dark"] {
    --brand: #60a5fa;
    --accent: #fbbf24;
    --muted: #94a3b8;
    --text: var(--dark-text);
    --surface: var(--dark-surface);
    --soft: var(--dark-bg);
    --border: var(--dark-border);
    --success: #34d399;
    --danger: #f87171;
    --warning: #fbbf24;
    --info: #60a5fa;
    --shadow-sm: 0 1px 3px rgba(0, 0, 0, 0.5);
    --shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.4), 0 2px 4px -1px rgba(0, 0, 0, 0.3);
    --shadow-md: 0 10px 15px -3px rgba(0, 0, 0, 0.5), 0 4px 6px -2px rgba(0, 0, 0, 0.3);
    --shadow-lg: 0 20px 25px -5px rgba(0, 0, 0, 0.6), 0 10px 10px -5px rgba(0, 0, 0, 0.4);
    --shadow-xl: 0 25px 50px -12px rgba(0, 0, 0, 0.7);
}

[data-theme="modern"] {
    --brand: #2563eb;
    --accent: #f59e0b;
    --muted: #6b7280;
    --text: #111827;
    --surface: #ffffff;
    --soft: #f3f4f6;
    --border: #e5e7eb;
    --success: #10b981;
    --danger: #ef4444;
}

[data-theme="pastel"] {
    --brand: #8b5cf6;
    --accent: #ec4899;
    --muted: #6b7280;
    --text: #1f2937;
    --surface: #fef3c7;
    --soft: #fce7f3;
    --border: #e5e7eb;
    --success: #10b981;
    --danger: #ef4444;
}

@media (prefers-color-scheme: dark) {
    [data-theme="system"] {
        --brand: #60a5fa;
        --accent: #fbbf24;
        --muted: #94a3b8;
        --text: var(--dark-text);
        --surface: var(--dark-surface);
        --soft: var(--dark-bg);
        --border: var(--dark-border);
        --success: #34d399;
        --danger: #f87171;
    }
}

/* ============================
   NAVBAR
   ============================ */
.navbar {
    background: rgba(255, 255, 255, 0.95);
    backdrop-filter: var(--backdrop-blur);
    -webkit-backdrop-filter: var(--backdrop-blur);
    box-shadow: var(--shadow);
    border-bottom: 1px solid var(--border);
    transition: all var(--transition-base);
    position: sticky;
    top: 0;
    z-index: 1030;
}

[data-theme="dark"] .navbar {
    background: rgba(30, 41, 59, 0.95);
}

[data-theme="modern"] .navbar {
    background: rgba(255, 255, 255, 0.95);
}

[data-theme="pastel"] .navbar {
    background: rgba(254, 243, 199, 0.95);
}

.navbar-brand {
    font-weight: 700;
    display: flex;
    align-items: center;
    gap: 1rem;
    transition: transform var(--transition-fast);
}

.navbar-brand:hover {
    transform: translateY(-1px);
}

.navbar-brand img {
    height: 44px;
    transition: transform var(--transition-base);
}

.navbar-brand:hover img {
    transform: scale(1.02);
}

.navbar .btn-link {
    color: var(--muted);
    position: relative;
    padding: 0.5rem;
    border-radius: var(--radius-sm);
    transition: all var(--transition-fast);
}

.navbar .btn-link:hover {
    color: var(--brand);
    background: rgba(11, 59, 97, 0.05);
    transform: translateY(-1px);
}

[data-theme="dark"] .navbar .btn-link:hover {
    background: rgba(96, 165, 250, 0.1);
}

[data-theme="modern"] .navbar .btn-link:hover {
    background: rgba(37, 99, 235, 0.08);
}

[data-theme="pastel"] .navbar .btn-link:hover {
    background: rgba(139, 92, 246, 0.08);
}

/* ============================
   SEARCH BOX
   ============================ */
.search-box {
    position: relative;
    max-width: 500px;
    width: 100%;
}

.search-box input {
    padding: 0.625rem 1rem 0.625rem 3rem;
    border-radius: 24px;
    border: 2px solid var(--border);
    background: var(--soft);
    color: var(--text);
    transition: all var(--transition-base);
    width: 100%;
    font-size: 0.9375rem;
}

.search-box input:focus {
    border-color: var(--brand);
    background: var(--surface);
    outline: none;
    box-shadow: 0 0 0 3px rgba(11, 59, 97, 0.08);
    transform: translateY(-1px);
}

[data-theme="dark"] .search-box input:focus {
    box-shadow: 0 0 0 3px rgba(96, 165, 250, 0.12);
}

[data-theme="modern"] .search-box input:focus {
    box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.1);
}

[data-theme="pastel"] .search-box input:focus {
    box-shadow: 0 0 0 3px rgba(139, 92, 246, 0.1);
}

.search-box input::placeholder {
    color: var(--muted);
    opacity: 0.7;
}

.search-box i {
    position: absolute;
    left: 1.125rem;
    top: 50%;
    transform: translateY(-50%);
    color: var(--muted);
    font-size: 1.125rem;
    transition: color var(--transition-fast);
    pointer-events: none;
}

.search-box input:focus ~ i {
    color: var(--brand);
}

/* ============================
   SIDEBAR
   ============================ */
.sidebar {
    position: fixed;
    top: 72px;
    left: 0;
    width: 280px;
    height: calc(100vh - 72px);
    background: var(--surface);
    border-right: 1px solid var(--border);
    overflow-y: auto;
    overflow-x: hidden;
    transition: transform var(--transition-base), background var(--transition-base);
    z-index: 1020;
    box-shadow: var(--shadow);
}

.sidebar::-webkit-scrollbar {
    width: 6px;
}

.sidebar.collapsed {
    transform: translateX(-280px);
}

.sidebar-item {
    padding: 0.875rem 1.5rem;
    display: flex;
    align-items: center;
    gap: 0.875rem;
    color: var(--text);
    text-decoration: none;
    transition: all var(--transition-fast);
    cursor: pointer;
    border-left: 3px solid transparent;
    position: relative;
    font-weight: 500;
    font-size: 0.9375rem;
}

.sidebar-item::before {
    content: '';
    position: absolute;
    left: 0;
    top: 0;
    bottom: 0;
    width: 3px;
    background: var(--accent);
    transform: scaleY(0);
    transition: transform var(--transition-base);
    transform-origin: center;
}

.sidebar-item:hover {
    background: linear-gradient(90deg, rgba(11, 59, 97, 0.06) 0%, transparent 100%);
    color: var(--brand);
    padding-left: 1.625rem;
}

[data-theme="dark"] .sidebar-item:hover {
    background: linear-gradient(90deg, rgba(96, 165, 250, 0.1) 0%, transparent 100%);
}

[data-theme="modern"] .sidebar-item:hover {
    background: linear-gradient(90deg, rgba(37, 99, 235, 0.08) 0%, transparent 100%);
}

[data-theme="pastel"] .sidebar-item:hover {
    background: linear-gradient(90deg, rgba(139, 92, 246, 0.08) 0%, transparent 100%);
}

.sidebar-item.active {
    background: linear-gradient(90deg, rgba(11, 59, 97, 0.08) 0%, transparent 100%);
    color: var(--brand);
    font-weight: 600;
}

.sidebar-item.active::before {
    transform: scaleY(1);
}

[data-theme="dark"] .sidebar-item.active {
    background: linear-gradient(90deg, rgba(96, 165, 250, 0.12) 0%, transparent 100%);
}

[data-theme="modern"] .sidebar-item.active {
    background: linear-gradient(90deg, rgba(37, 99, 235, 0.1) 0%, transparent 100%);
}

[data-theme="pastel"] .sidebar-item.active {
    background: linear-gradient(90deg, rgba(139, 92, 246, 0.1) 0%, transparent 100%);
}

.sidebar-item i {
    font-size: 1.25rem;
    width: 24px;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: transform var(--transition-fast);
}

.sidebar-item:hover i {
    transform: scale(1.05);
}

/* ============================
   MAIN CONTENT
   ============================ */
.main-content {
    margin-left: 280px;
    min-height: calc(100vh - 72px);
    padding: 2rem;
    transition: margin-left var(--transition-base);
}

.main-content.expanded {
    margin-left: 0;
}

/* ============================
   CARDS
   ============================ */
.card-modern {
    border: 0;
    background: var(--surface);
    box-shadow: var(--shadow);
    border-radius: var(--radius-md);
    overflow: hidden;
    color: var(--text);
    transition: all var(--transition-base);
    position: relative;
}

.card-modern::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    height: 3px;
    background: linear-gradient(90deg, var(--brand), var(--accent));
    opacity: 0;
    transition: opacity var(--transition-base);
}

.card-modern:hover {
    transform: translateY(-3px);
    box-shadow: var(--shadow-md);
}

.card-modern:hover::before {
    opacity: 1;
}

/* ============================
   COURSE CARDS
   ============================ */
.course-card {
    position: relative;
    overflow: hidden;
}

.course-thumbnail {
    height: 200px;
    width: 100%;
    object-fit: cover;
    background: linear-gradient(135deg, rgba(11, 59, 97, 0.1), rgba(212, 175, 55, 0.1));
    transition: all var(--transition-slow);
}

.course-card:hover .course-thumbnail {
    transform: scale(1.03);
}

.course-badge {
    position: absolute;
    top: 0.875rem;
    right: 0.875rem;
    background: rgba(255, 255, 255, 0.98);
    backdrop-filter: var(--backdrop-blur);
    padding: 0.5rem 1rem;
    border-radius: 20px;
    font-size: 0.75rem;
    font-weight: 600;
    color: var(--brand);
    box-shadow: var(--shadow);
    transition: all var(--transition-fast);
    z-index: 10;
}

[data-theme="dark"] .course-badge {
    background: rgba(30, 41, 59, 0.98);
    color: var(--accent);
}

[data-theme="modern"] .course-badge {
    background: rgba(255, 255, 255, 0.98);
    color: var(--brand);
}

[data-theme="pastel"] .course-badge {
    background: rgba(254, 243, 199, 0.98);
    color: var(--brand);
}

.course-card:hover .course-badge {
    transform: translateY(-1px);
    box-shadow: var(--shadow-md);
}

.progress-ring {
    position: absolute;
    top: 0.875rem;
    left: 0.875rem;
    width: 52px;
    height: 52px;
    background: rgba(255, 255, 255, 0.98);
    backdrop-filter: var(--backdrop-blur);
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-weight: 700;
    color: var(--success);
    font-size: 0.75rem;
    box-shadow: var(--shadow);
    border: 3px solid var(--success);
    transition: all var(--transition-fast);
    z-index: 10;
}

[data-theme="dark"] .progress-ring {
    background: rgba(30, 41, 59, 0.98);
}

[data-theme="modern"] .progress-ring {
    background: rgba(255, 255, 255, 0.98);
}

[data-theme="pastel"] .progress-ring {
    background: rgba(254, 243, 199, 0.98);
}

.course-card:hover .progress-ring {
    transform: scale(1.05);
}

/* ============================
   STAT CARDS
   ============================ */
.stat-card {
    background: linear-gradient(135deg, var(--brand) 0%, #0d5a8f 100%);
    color: #fff;
    border-radius: var(--radius-md);
    padding: 1.75rem;
    position: relative;
    overflow: hidden;
    transition: all var(--transition-base);
    box-shadow: var(--shadow-md);
}

[data-theme="dark"] .stat-card {
    background: linear-gradient(135deg, #1e40af 0%, #1e3a8a 100%);
}

[data-theme="modern"] .stat-card {
    background: linear-gradient(135deg, #2563eb 0%, #1d4ed8 100%);
}

[data-theme="pastel"] .stat-card {
    background: linear-gradient(135deg, #8b5cf6 0%, #7c3aed 100%);
}

.stat-card::before {
    content: '';
    position: absolute;
    top: -60%;
    right: -25%;
    width: 240px;
    height: 240px;
    background: rgba(255, 255, 255, 0.08);
    border-radius: 50%;
    transition: transform var(--transition-slow);
}

.stat-card:hover::before {
    transform: scale(1.1) translate(-5px, 5px);
}

.stat-card:hover {
    transform: translateY(-2px);
    box-shadow: var(--shadow-lg);
}

.stat-card h3 {
    font-size: 2.25rem;
    font-weight: 700;
    margin: 0.5rem 0;
    position: relative;
    z-index: 1;
}

.stat-card small {
    position: relative;
    z-index: 1;
    font-size: 0.875rem;
    opacity: 0.95;
}

.stat-card i {
    font-size: 3.5rem;
    opacity: 0.2;
    position: absolute;
    right: 1.25rem;
    top: 50%;
    transform: translateY(-50%);
    transition: all var(--transition-base);
}

.stat-card:hover i {
    opacity: 0.25;
    transform: translateY(-50%) rotate(5deg) scale(1.03);
}

/* ============================
   TIMELINE
   ============================ */
.timeline-item {
    position: relative;
    padding-left: 3rem;
    padding-bottom: 2rem;
    transition: opacity var(--transition-fast);
}

.timeline-item:last-child {
    padding-bottom: 0;
}

.timeline-item:last-child::before {
    display: none;
}

.timeline-item::before {
    content: '';
    position: absolute;
    left: 0.6875rem;
    top: 2rem;
    bottom: 0;
    width: 2px;
    background: linear-gradient(180deg, var(--accent) 0%, transparent 100%);
}

.timeline-dot {
    position: absolute;
    left: 0;
    top: 0.25rem;
    width: 28px;
    height: 28px;
    background: var(--accent);
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    color: #fff;
    font-size: 0.875rem;
    box-shadow: 0 0 0 4px var(--surface), var(--shadow);
    transition: all var(--transition-base);
    z-index: 10;
}

.timeline-item:hover .timeline-dot {
    transform: scale(1.08);
    box-shadow: 0 0 0 6px var(--surface), var(--shadow-md);
}

/* ============================
   VIDEO CARDS
   ============================ */
.video-card {
    background: var(--surface);
    border-radius: var(--radius-lg);
    box-shadow: var(--shadow);
    overflow: hidden;
    transition: all var(--transition-base);
    cursor: pointer;
    position: relative;
}

.video-card::after {
    content: '';
    position: absolute;
    bottom: 0;
    left: 0;
    right: 0;
    height: 4px;
    background: linear-gradient(90deg, var(--brand), var(--accent));
    transform: scaleX(0);
    transition: transform var(--transition-base);
    transform-origin: left;
}

.video-card:hover {
    transform: translateY(-4px);
    box-shadow: var(--shadow-lg);
}

.video-card:hover::after {
    transform: scaleX(1);
}

.video-thumb {
    position: relative;
    overflow: hidden;
    border-bottom: 1px solid var(--border);
}

.video-thumb-img {
    width: 100%;
    height: 200px;
    object-fit: cover;
    transition: transform var(--transition-slow), filter var(--transition-base);
    display: block;
}

.video-card:hover .video-thumb-img {
    transform: scale(1.04);
    filter: brightness(0.9);
}

.video-overlay {
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: radial-gradient(circle, rgba(11, 59, 97, 0.5) 0%, rgba(0, 0, 0, 0.6) 100%);
    opacity: 0;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: opacity var(--transition-base);
}

[data-theme="dark"] .video-overlay {
    background: radial-gradient(circle, rgba(30, 41, 59, 0.6) 0%, rgba(0, 0, 0, 0.7) 100%);
}

.video-card:hover .video-overlay {
    opacity: 1;
}

.play-icon {
    color: #fff;
    font-size: 3.5rem;
    transition: transform var(--transition-base);
    filter: drop-shadow(0 4px 8px rgba(0, 0, 0, 0.3));
}

.video-card:hover .play-icon {
    transform: scale(1.1);
}

.video-badge {
    position: absolute;
    top: 0.875rem;
    left: 0.875rem;
    background: var(--brand);
    color: #fff;
    font-size: 0.6875rem;
    padding: 0.375rem 0.75rem;
    border-radius: 14px;
    font-weight: 600;
    box-shadow: var(--shadow);
    text-transform: uppercase;
    letter-spacing: 0.5px;
    transition: all var(--transition-fast);
    z-index: 10;
}

[data-theme="modern"] .video-badge {
    background: var(--accent);
}

[data-theme="pastel"] .video-badge {
    background: var(--accent);
}

.video-card:hover .video-badge {
    transform: translateY(-1px);
    box-shadow: var(--shadow-md);
}

.video-body {
    padding: 1rem 1.125rem;
}

.video-title {
    font-weight: 600;
    font-size: 0.9375rem;
    margin-bottom: 0.5rem;
    color: var(--text);
    line-height: 1.4;
    display: -webkit-box;
    -webkit-line-clamp: 2;
    -webkit-box-orient: vertical;
    overflow: hidden;
}

.video-author {
    color: var(--muted);
    font-size: 0.8125rem;
    margin: 0;
    display: flex;
    align-items: center;
    gap: 0.25rem;
}

/* ============================
   TABS
   ============================ */
.nav-tabs-modern {
    border: 0;
    gap: 0.5rem;
    margin-bottom: 1.5rem;
}

.nav-tabs-modern .nav-link {
    border: 0;
    border-radius: var(--radius-sm);
    padding: 0.75rem 1.5rem;
    color: var(--text);
    font-weight: 600;
    transition: all var(--transition-fast);
    position: relative;
    overflow: hidden;
}

.nav-tabs-modern .nav-link::before {
    content: '';
    position: absolute;
    bottom: 0;
    left: 0;
    right: 0;
    height: 3px;
    background: var(--brand);
    transform: scaleX(0);
    transition: transform var(--transition-base);
}

.nav-tabs-modern .nav-link:hover {
    background: rgba(11, 59, 97, 0.05);
    color: var(--brand);
}

[data-theme="dark"] .nav-tabs-modern .nav-link:hover {
    background: rgba(96, 165, 250, 0.08);
}

[data-theme="modern"] .nav-tabs-modern .nav-link:hover {
    background: rgba(37, 99, 235, 0.06);
}

[data-theme="pastel"] .nav-tabs-modern .nav-link:hover {
    background: rgba(139, 92, 246, 0.06);
}

.nav-tabs-modern .nav-link.active {
    background: var(--brand);
    color: #fff;
}

.nav-tabs-modern .nav-link.active::before {
    transform: scaleX(1);
}

/* ============================
   NOTIFICATIONS
   ============================ */
.notification-badge {
    position: absolute;
    top: -4px;
    right: -4px;
    background: var(--danger);
    color: #fff;
    border-radius: 50%;
    width: 22px;
    height: 22px;
    font-size: 0.6875rem;
    display: flex;
    align-items: center;
    justify-content: center;
    font-weight: 700;
    box-shadow: var(--shadow);
    animation: pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite;
}

@keyframes pulse {
    0%,
    100% {
        opacity: 1;
    }
    50% {
        opacity: 0.7;
    }
}

/* ============================
   DROPDOWN MENU
   ============================ */
.dropdown-menu {
    border-radius: var(--radius-md);
    background: var(--surface);
    box-shadow: var(--shadow-lg);
    animation: dropdownFade var(--transition-base) ease;
    border: 1px solid var(--border);
    padding: 0.5rem;
    min-width: 200px;
}

.dropdown-menu .dropdown-item {
    border-radius: var(--radius-sm);
    transition: all var(--transition-fast);
    padding: 0.625rem 1rem;
    display: flex;
    align-items: center;
    gap: 0.5rem;
}

.dropdown-menu .dropdown-item:hover {
    background: rgba(11, 59, 97, 0.05);
    color: var(--brand);
    transform: translateX(2px);
}

[data-theme="dark"] .dropdown-menu .dropdown-item:hover {
    background: rgba(96, 165, 250, 0.08);
}

[data-theme="modern"] .dropdown-menu .dropdown-item:hover {
    background: rgba(37, 99, 235, 0.06);
}

[data-theme="pastel"] .dropdown-menu .dropdown-item:hover {
    background: rgba(139, 92, 246, 0.06);
}

.dropdown-menu .dropdown-item:active {
    background: rgba(11, 59, 97, 0.08);
}

@keyframes dropdownFade {
    from {
        opacity: 0;
        transform: translateY(-8px);
    }
    to {
        opacity: 1;
        transform: translateY(0);
    }
}

/* ============================
   BUTTONS
   ============================ */
.btn {
    border-radius: var(--radius-sm);
    font-weight: 600;
    transition: all var(--transition-fast);
    position: relative;
    overflow: hidden;
}

.btn::before {
    content: '';
    position: absolute;
    top: 50%;
    left: 50%;
    width: 0;
    height: 0;
    border-radius: 50%;
    background: rgba(255, 255, 255, 0.3);
    transform: translate(-50%, -50%);
    transition: width var(--transition-base), height var(--transition-base);
}

.btn:hover::before {
    width: 300px;
    height: 300px;
}

.btn-primary {
    background: linear-gradient(135deg, var(--brand) 0%, #0d5a8f 100%);
    border: none;
    box-shadow: var(--shadow);
}

[data-theme="dark"] .btn-primary {
    background: linear-gradient(135deg, #1e40af 0%, #1e3a8a 100%);
}

[data-theme="modern"] .btn-primary {
    background: linear-gradient(135deg, #2563eb 0%, #1d4ed8 100%);
}

[data-theme="pastel"] .btn-primary {
    background: linear-gradient(135deg, #8b5cf6 0%, #7c3aed 100%);
}

.btn-primary:hover {
    transform: translateY(-1px);
    box-shadow: var(--shadow-md);
}

.btn-primary:active {
    transform: translateY(0);
    box-shadow: var(--shadow-sm);
}

.btn-outline-primary {
    border: 2px solid var(--brand);
    color: var(--brand);
    background: transparent;
}

.btn-outline-primary:hover {
    background: var(--brand);
    color: #fff;
    transform: translateY(-1px);
    box-shadow: var(--shadow);
}

.btn-outline-secondary {
    border: 2px solid var(--muted);
    color: var(--muted);
    background: transparent;
}

.btn-outline-secondary:hover {
    background: var(--muted);
    color: #fff;
    transform: translateY(-1px);
    box-shadow: var(--shadow);
}

.btn-outline-success {
    border: 2px solid var(--success);
    color: var(--success);
    background: transparent;
}

.btn-outline-success:hover {
    background: var(--success);
    color: #fff;
    transform: translateY(-1px);
    box-shadow: var(--shadow);
}

/* ============================
   PROGRESS BARS
   ============================ */
.progress {
    border-radius: 10px;
    overflow: hidden;
    background: var(--border);
    box-shadow: inset 0 1px 3px rgba(0, 0, 0, 0.1);
}

.progress-bar {
    transition: width var(--transition-slow);
    background: linear-gradient(90deg, var(--brand), var(--accent));
    position: relative;
    overflow: hidden;
}

.progress-bar::after {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    bottom: 0;
    right: 0;
    background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.3), transparent);
    animation: shimmer 2s infinite;
}

@keyframes shimmer {
    0% {
        transform: translateX(-100%);
    }
    100% {
        transform: translateX(100%);
    }
}

/* ============================
   MODALS - ENLARGED
   ============================ */
.modal-dialog {
    max-width: 900px;
    margin: 1.75rem auto;
}

.modal-dialog-centered {
    min-height: calc(100% - 3.5rem);
}

.video-modal .modal-dialog {
    max-width: 1200px;
}

.document-modal .modal-dialog {
    max-width: 1100px;
}

.modal-content {
    border-radius: var(--radius-lg);
    border: none;
    box-shadow: var(--shadow-xl);
    overflow: hidden;
    background: var(--surface);
}

.modal-header {
    border-bottom: 1px solid var(--border);
    padding: 1.75rem 2rem;
    background: linear-gradient(135deg, rgba(11, 59, 97, 0.03), transparent);
}

[data-theme="dark"] .modal-header {
    background: linear-gradient(135deg, rgba(96, 165, 250, 0.05), transparent);
}

[data-theme="modern"] .modal-header {
    background: linear-gradient(135deg, rgba(37, 99, 235, 0.04), transparent);
}

[data-theme="pastel"] .modal-header {
    background: linear-gradient(135deg, rgba(139, 92, 246, 0.04), transparent);
}

.modal-title {
    font-size: 1.5rem;
    font-weight: 700;
    color: var(--brand);
}

.modal-body {
    padding: 2rem;
}

.modal-backdrop {
    backdrop-filter: blur(4px);
    background: rgba(0, 0, 0, 0.5);
}

[data-theme="dark"] .modal-backdrop {
    background: rgba(0, 0, 0, 0.7);
}

.btn-close {
    background: transparent url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 16 16' fill='%23000'%3e%3cpath d='M.293.293a1 1 0 011.414 0L8 6.586 14.293.293a1 1 0 111.414 1.414L9.414 8l6.293 6.293a1 1 0 01-1.414 1.414L8 9.414l-6.293 6.293a1 1 0 01-1.414-1.414L6.586 8 .293 1.707a1 1 0 010-1.414z'/%3e%3c/svg%3e") center/1em auto no-repeat;
    width: 1.5rem;
    height: 1.5rem;
    opacity: 0.6;
    transition: all var(--transition-fast);
}

.btn-close:hover {
    opacity: 1;
    transform: rotate(90deg);
}

[data-theme="dark"] .btn-close {
    filter: invert(1) grayscale(100%) brightness(200%);
}

/* ============================
   FORM CONTROLS
   ============================ */
.form-control,
.form-select {
    border-radius: var(--radius-sm);
    border: 2px solid var(--border);
    transition: all var(--transition-fast);
    background: var(--soft);
    color: var(--text);
    padding: 0.625rem 1rem;
    font-size: 0.9375rem;
}

.form-control:focus,
.form-select:focus {
    border-color: var(--brand);
    box-shadow: 0 0 0 3px rgba(11, 59, 97, 0.08);
    outline: none;
    background: var(--surface);
}

[data-theme="dark"] .form-control:focus,
[data-theme="dark"] .form-select:focus {
    box-shadow: 0 0 0 3px rgba(96, 165, 250, 0.12);
}

[data-theme="modern"] .form-control:focus,
[data-theme="modern"] .form-select:focus {
    box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.1);
}

[data-theme="pastel"] .form-control:focus,
[data-theme="pastel"] .form-select:focus {
    box-shadow: 0 0 0 3px rgba(139, 92, 246, 0.1);
}

.form-control::placeholder {
    color: var(--muted);
    opacity: 0.65;
}

/* ============================
   LOADER
   ============================ */
.loader {
    width: 48px;
    height: 48px;
    border: 4px solid var(--border);
    border-top-color: var(--brand);
    border-radius: 50%;
    animation: spin 1s linear infinite;
    margin: 0 auto;
}

@keyframes spin {
    to {
        transform: rotate(360deg);
    }
}

/* ============================
   FADE IN ANIMATION
   ============================ */
.fade-in {
    animation: fadeIn 0.5s ease-in-out both;
}

@keyframes fadeIn {
    from {
        opacity: 0;
        transform: translateY(12px);
    }
    to {
        opacity: 1;
        transform: translateY(0);
    }
}

/* Staggered animation for grids */
.fade-in:nth-child(1) { animation-delay: 0.05s; }
.fade-in:nth-child(2) { animation-delay: 0.1s; }
.fade-in:nth-child(3) { animation-delay: 0.15s; }
.fade-in:nth-child(4) { animation-delay: 0.2s; }
.fade-in:nth-child(5) { animation-delay: 0.25s; }
.fade-in:nth-child(6) { animation-delay: 0.3s; }
.fade-in:nth-child(7) { animation-delay: 0.35s; }
.fade-in:nth-child(8) { animation-delay: 0.4s; }
.fade-in:nth-child(9) { animation-delay: 0.45s; }
.fade-in:nth-child(10) { animation-delay: 0.5s; }

/* ============================
   WELCOME MESSAGE
   ============================ */
#welcomeMessage {
    color: var(--brand);
    font-size: 0.9375rem;
    margin-right: 0.75rem;
    white-space: nowrap;
    font-weight: 500;
    transition: color var(--transition-fast);
}

[data-theme="dark"] #welcomeMessage {
    color: var(--accent);
}

[data-theme="modern"] #welcomeMessage {
    color: var(--brand);
}

[data-theme="pastel"] #welcomeMessage {
    color: var(--brand);
}

/* ============================
   BREADCRUMB
   ============================ */
#breadcrumb {
    font-size: 0.875rem;
    color: var(--muted);
    display: flex;
    align-items: center;
    gap: 0.5rem;
    flex-wrap: wrap;
}

#breadcrumb a {
    color: var(--brand);
    transition: all var(--transition-fast);
    padding: 0.25rem 0.5rem;
    border-radius: var(--radius-sm);
}

#breadcrumb a:hover {
    background: rgba(11, 59, 97, 0.05);
    color: var(--accent);
    transform: translateY(-1px);
}

[data-theme="dark"] #breadcrumb a:hover {
    background: rgba(96, 165, 250, 0.08);
}

[data-theme="modern"] #breadcrumb a:hover {
    background: rgba(37, 99, 235, 0.06);
}

[data-theme="pastel"] #breadcrumb a:hover {
    background: rgba(139, 92, 246, 0.06);
}

/* ============================
   ALERTS & TOASTS
   ============================ */
.alert {
    border-radius: var(--radius-md);
    border: none;
    box-shadow: var(--shadow);
    animation: slideInRight 0.3s ease-out;
    padding: 1rem 1.25rem;
}

@keyframes slideInRight {
    from {
        transform: translateX(100%);
        opacity: 0;
    }
    to {
        transform: translateX(0);
        opacity: 1;
    }
}

.alert-success {
    background: linear-gradient(135deg, var(--success) 0%, #0d9488 100%);
    color: #fff;
}

.alert-info {
    background: linear-gradient(135deg, var(--info) 0%, #2563eb 100%);
    color: #fff;
}

.alert-warning {
    background: linear-gradient(135deg, var(--warning) 0%, #f59e0b 100%);
    color: #fff;
}

.alert-danger {
    background: linear-gradient(135deg, var(--danger) 0%, #dc2626 100%);
    color: #fff;
}

/* ============================
   PROFILE DROPDOWN
   ============================ */
#profileDropdown img {
    transition: all var(--transition-fast);
    box-shadow: var(--shadow);
}

#profileDropdown:hover img {
    transform: scale(1.03);
    box-shadow: var(--shadow-md);
}

.dropdown-toggle::after {
    transition: transform var(--transition-fast);
}

.dropdown-toggle[aria-expanded="true"]::after {
    transform: rotate(180deg);
}

/* ============================
   VIDEO/DOCUMENT CONTAINERS
   ============================ */
.video-container,
.document-container {
    position: relative;
    width: 100%;
    padding-bottom: 56.25%; /* 16:9 aspect ratio */
    background: #000;
    border-radius: var(--radius-md);
    overflow: hidden;
    min-height: 500px;
}

.video-container iframe,
.document-container iframe {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    border: none;
}

/* ============================
   CALENDAR EVENTS
   ============================ */
#calendarEvents .d-flex {
    padding: 1rem;
    border-radius: var(--radius-sm);
    transition: all var(--transition-fast);
    cursor: pointer;
}

#calendarEvents .d-flex:hover {
    background: rgba(11, 59, 97, 0.03);
    transform: translateX(4px);
}

[data-theme="dark"] #calendarEvents .d-flex:hover {
    background: rgba(96, 165, 250, 0.05);
}

[data-theme="modern"] #calendarEvents .d-flex:hover {
    background: rgba(37, 99, 235, 0.04);
}

[data-theme="pastel"] #calendarEvents .d-flex:hover {
    background: rgba(139, 92, 246, 0.04);
}

#calendarEvents .bg-primary,
#calendarEvents .bg-warning {
    border-radius: var(--radius-sm);
    box-shadow: var(--shadow);
    transition: all var(--transition-fast);
}

#calendarEvents .d-flex:hover .bg-primary,
#calendarEvents .d-flex:hover .bg-warning {
    transform: scale(1.03);
    box-shadow: var(--shadow-md);
}

/* ============================
   NOTES CARDS
   ============================ */
#notesList .card-modern {
    border-left: 4px solid var(--accent);
}

#notesList .card-modern:hover {
    border-left-color: var(--brand);
}

/* ============================
   CHART CONTAINER
   ============================ */
#progressChart {
    border-radius: var(--radius-md);
    padding: 1rem;
}

/* ============================
   THEME SELECT
   ============================ */
#themeSelect {
    background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='16' height='16' fill='%23666' viewBox='0 0 16 16'%3E%3Cpath d='M7.247 11.14L2.451 5.658C1.885 5.013 2.345 4 3.204 4h9.592a1 1 0 0 1 .753 1.659l-4.796 5.48a1 1 0 0 1-1.506 0z'/%3E%3C/svg%3E");
    background-repeat: no-repeat;
    background-position: right 0.75rem center;
    background-size: 16px 12px;
    padding-right: 2.5rem;
    cursor: pointer;
}

/* ============================
   AUTH MODAL ENHANCEMENTS
   ============================ */
#modalAuth .modal-dialog {
    max-width: 550px;
}

#modalAuth .modal-header {
    background: linear-gradient(135deg, rgba(11, 59, 97, 0.04), transparent);
    border-bottom: 1px solid var(--border);
    padding: 1.5rem 2rem;
}

#modalAuth .nav-tabs-modern {
    border-bottom: none;
    margin-bottom: 0;
}

#modalAuth .tab-content {
    padding-top: 1rem;
}

#modalAuth input[type="email"],
#modalAuth input[type="password"],
#modalAuth input[type="text"] {
    font-size: 0.9375rem;
    padding: 0.875rem 1.125rem;
    border-radius: var(--radius-sm);
}

#modalAuth .btn {
    font-size: 0.9375rem;
    padding: 0.875rem;
    font-weight: 600;
}

#modalAuth .btn-outline-dark {
    border: 2px solid var(--border);
    color: var(--text);
}

#modalAuth .btn-outline-dark:hover {
    background: var(--dark-surface);
    color: #fff;
    border-color: var(--dark-surface);
}

[data-theme="dark"] #modalAuth .btn-outline-dark {
    border-color: var(--dark-border);
}

[data-theme="dark"] #modalAuth .btn-outline-dark:hover {
    background: var(--brand);
    border-color: var(--brand);
}

/* ============================
   EMPTY STATE
   ============================ */
.text-center.text-muted {
    padding: 3rem 1rem;
    color: var(--brand);
}

.text-center.text-muted i {
    opacity: 0.5;
    transition: all var(--transition-base);
}

.card-modern:hover .text-center.text-muted i {
    opacity: 0.65;
    transform: scale(1.03);
}

/* ============================
   BADGES & LABELS
   ============================ */
.badge {
    padding: 0.375rem 0.75rem;
    border-radius: 12px;
    font-weight: 600;
    font-size: 0.75rem;
    letter-spacing: 0.3px;
}

/* ============================
   RESPONSIVE ADJUSTMENTS
   ============================ */
@media (max-width: 1399px) {
    .main-content {
        padding: 1.5rem;
    }
    
    .modal-dialog {
        max-width: 800px;
    }
    
    .video-modal .modal-dialog {
        max-width: 1000px;
    }
}

@media (max-width: 1199px) {
    .stat-card h3 {
        font-size: 2rem;
    }
    
    .stat-card i {
        font-size: 3rem;
    }
    
    .modal-dialog {
        max-width: 700px;
    }
}

@media (max-width: 991px) {
    .sidebar {
        transform: translateX(-280px);
        box-shadow: none;
    }

    .sidebar.show {
        transform: translateX(0);
        box-shadow: var(--shadow-xl);
    }

    .main-content {
        margin-left: 0;
        padding: 1.5rem;
    }

    .search-box {
        max-width: 100%;
    }

    .navbar-brand div {
        font-size: 0.8125rem;
    }

    .stat-card {
        padding: 1.5rem;
    }

    .stat-card h3 {
        font-size: 1.75rem;
    }

    .video-thumb-img {
        height: 180px;
    }
    
    .modal-dialog {
        max-width: 90%;
        margin: 1rem auto;
    }
    
    .modal-body {
        padding: 1.5rem;
    }
    
    .modal-header {
        padding: 1.25rem 1.5rem;
    }
}

@media (max-width: 767px) {
    .main-content {
        padding: 1rem;
    }

    .navbar-brand img {
        height: 36px;
    }

    .course-thumbnail {
        height: 160px;
    }

    .stat-card {
        padding: 1.25rem;
    }

    .stat-card h3 {
        font-size: 1.5rem;
    }

    .stat-card i {
        font-size: 2.5rem;
        right: 1rem;
    }

    .card-modern {
        border-radius: var(--radius-sm);
    }

    .video-thumb-img {
        height: 160px;
    }

    .timeline-item {
        padding-left: 2.5rem;
    }

    .dropdown-menu {
        min-width: 280px;
    }

    #modalAuth .modal-body {
        padding: 1.5rem 1rem;
    }
    
    .modal-dialog {
        max-width: 95%;
        margin: 0.5rem auto;
    }
    
    .modal-title {
        font-size: 1.25rem;
    }
    
    .video-container,
    .document-container {
        min-height: 350px;
    }
}

@media (max-width: 575px) {
    h2 {
        font-size: 1.5rem;
    }

    .stat-card h3 {
        font-size: 1.25rem;
    }

    .stat-card::before {
        width: 180px;
        height: 180px;
    }

    .play-icon {
        font-size: 2.5rem;
    }

    .course-thumbnail {
        height: 140px;
    }

    .video-thumb-img {
        height: 140px;
    }

    .navbar {
        padding: 0.5rem 0.75rem;
    }

    .search-box input {
        font-size: 0.875rem;
        padding: 0.5rem 0.875rem 0.5rem 2.5rem;
    }

    .search-box i {
        left: 0.875rem;
        font-size: 1rem;
    }
    
    .video-container,
    .document-container {
        min-height: 280px;
    }
    
    .modal-header {
        padding: 1rem;
    }
    
    .modal-body {
        padding: 1rem;
    }
}

/* ============================
   PRINT STYLES
   ============================ */
@media print {
    .navbar,
    .sidebar,
    .btn,
    .dropdown {
        display: none !important;
    }

    .main-content {
        margin-left: 0 !important;
    }

    .card-modern {
        box-shadow: none !important;
        page-break-inside: avoid;
    }
}

/* ============================
   ACCESSIBILITY IMPROVEMENTS
   ============================ */
.visually-hidden {
    position: absolute;
    width: 1px;
    height: 1px;
    padding: 0;
    margin: -1px;
    overflow: hidden;
    clip: rect(0, 0, 0, 0);
    white-space: nowrap;
    border-width: 0;
}

:focus-visible {
    outline: 2px solid var(--accent);
    outline-offset: 2px;
}

/* High contrast mode support */
@media (prefers-contrast: high) {
    .card-modern {
        border: 2px solid var(--border);
    }

    .btn {
        border: 2px solid currentColor;
    }
}

/* Reduced motion support */
@media (prefers-reduced-motion: reduce) {
    *,
    *::before,
    *::after {
        animation-duration: 0.01ms !important;
        animation-iteration-count: 1 !important;
        transition-duration: 0.01ms !important;
        scroll-behavior: auto !important;
    }
}

/* ============================
   UTILITY CLASSES
   ============================ */
.text-gradient {
    background: linear-gradient(135deg, var(--brand), var(--accent));
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
}

.glass-effect {
    background: rgba(255, 255, 255, 0.1);
    backdrop-filter: var(--backdrop-blur);
    -webkit-backdrop-filter: var(--backdrop-blur);
    border: 1px solid rgba(255, 255, 255, 0.2);
}

[data-theme="dark"] .glass-effect {
    background: rgba(30, 41, 59, 0.5);
    border: 1px solid rgba(255, 255, 255, 0.1);
}

.hover-lift {
    transition: transform var(--transition-fast);
}

.hover-lift:hover {
    transform: translateY(-2px);
}

.text-shadow {
    text-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
}

.box-glow {
    box-shadow: 0 0 20px rgba(11, 59, 97, 0.3);
}

[data-theme="dark"] .box-glow {
    box-shadow: 0 0 20px rgba(96, 165, 250, 0.3);
}

/* ============================
   SKELETON LOADING
   ============================ */
.skeleton {
    background: linear-gradient(
        90deg,
        var(--border) 0%,
        var(--soft) 50%,
        var(--border) 100%
    );
    background-size: 200% 100%;
    animation: skeleton-loading 1.5s ease-in-out infinite;
    border-radius: var(--radius-sm);
}

@keyframes skeleton-loading {
    0% {
        background-position: 200% 0;
    }
    100% {
        background-position: -200% 0;
    }
}

/* ============================
   CUSTOM SELECT STYLING
   ============================ */
.form-select {
    cursor: pointer;
    appearance: none;
    -webkit-appearance: none;
    -moz-appearance: none;
}

.form-select::-ms-expand {
    display: none;
}

/* ============================
   LOADING STATE
   ============================ */
.loading {
    pointer-events: none;
    opacity: 0.6;
    position: relative;
}

.loading::after {
    content: '';
    position: absolute;
    top: 50%;
    left: 50%;
    width: 24px;
    height: 24px;
    margin: -12px 0 0 -12px;
    border: 3px solid var(--border);
    border-top-color: var(--brand);
    border-radius: 50%;
    animation: spin 0.8s linear infinite;
}

/* ============================
   ENHANCED TRANSITIONS
   ============================ */
.card-body {
    transition: all var(--transition-base);
}

/* Smooth color transitions for theme changes */
* {
    transition-property: background-color, border-color, color, fill, stroke;
    transition-duration: var(--transition-base);
    transition-timing-function: ease-in-out;
}

/* Exclude specific properties from global transition */
*:not(.no-transition) {
    transition: background-color var(--transition-base), 
                border-color var(--transition-base), 
                color var(--transition-base);
}
    </style>
</head>

<body data-theme="light"> <!-- Thème par défaut -->

    <!-- Navigation -->

    <nav class="navbar navbar-expand-lg sticky-top">
        <div class="container-fluid">
            <!-- Sidebar Toggle -->
            <button class="btn btn-link me-2 d-lg-none" id="sidebarToggle">
                <i class="bi bi-list fs-4"></i>
            </button>

            <!-- Logo -->
            <a class="navbar-brand d-flex gap-3 align-items-center" href="#">
                <img src="https://espace-fpn.ump.ma/src/logo.svg" alt="logo" height="44">
                <div class="d-none d-md-block">
                    <div style="font-weight:700; color:var(--brand); font-size:14px">
                        Université Mohamed Premier
                    </div>
                    <div style="font-size:11px;color:var(--muted)">
                        Faculté des Sciences - Plateforme d'Apprentissage
                    </div>
                </div>
            </a>

            <!-- Right Side -->
            <div class="d-flex ms-auto gap-3 align-items-center">

                <!-- Search Box -->
                <div class="search-box d-none d-md-block">
                    <i class="bi bi-search"></i>
                    <input type="text" class="form-control" placeholder="Rechercher des cours, matériaux..."
                        id="searchInput">
                </div>

                <!-- Notifications -->
                <div class="dropdown">
                    <button class="btn btn-link position-relative" id="notifBtn" data-bs-toggle="dropdown">
                        <i class="bi bi-bell fs-5"></i>
                        <span class="notification-badge">3</span>
                    </button>
                    <div class="dropdown-menu dropdown-menu-end shadow-sm border-0 p-2" style="width:320px">
                        <h6 class="dropdown-header">Notifications</h6>
                        <div class="dropdown-item">
                            <small class="text-muted">Nouveau matériau de cours téléchargé</small>
                        </div>
                        <div class="dropdown-item">
                            <small class="text-muted">Devoir dû demain</small>
                        </div>
                    </div>
                </div>

                <!-- Profile Dropdown -->
                <div class="dropdown" id="profileDropdown" style="display: none;">
                    <a href="#" class="d-flex align-items-center gap-2 text-decoration-none dropdown-toggle"
                        id="profileMenu" data-bs-toggle="dropdown" aria-expanded="false">
                        <img id="userPhoto" src="" alt="Avatar"
                            style="width:40px;height:40px;border-radius:50%;object-fit:cover;border:2px solid var(--accent)">
                        <span id="userName" class="fw-semibold d-none d-md-inline"></span>
                    </a>
                    <ul class="dropdown-menu dropdown-menu-end shadow-sm border-0 p-2" aria-labelledby="profileMenu">
                        <li class="px-3 pb-2 border-bottom">
                            <small class="text-muted" id="userEmail"></small>
                        </li>
                        <li><a class="dropdown-item" href="#" data-view="settings"><i
                                    class="bi bi-gear me-2"></i>Paramètres</a></li>
                        <li><button class="dropdown-item text-danger" id="btnLogout"><i
                                    class="bi bi-box-arrow-right me-2"></i>Déconnexion</button></li>
                    </ul>
                </div>

                <!-- Login Button -->
                <button id="btnLogin" class="btn btn-primary">Se connecter</button>

            </div>
        </div>
    </nav>


    <!-- Sidebar -->
    <aside class="sidebar" id="sidebar">
        <div class="p-3">
            <h6 class="text-muted text-uppercase" style="font-size:11px; letter-spacing:1px">Navigation</h6>
        </div>

        <a class="sidebar-item active" data-view="dashboard">
            <i class="bi bi-speedometer2"></i>
            <span>Tableau de bord</span>
        </a>
        <a class="sidebar-item" data-view="courses">
            <i class="bi bi-collection"></i>
            <span>Tous les cours</span>
        </a>
        <a class="sidebar-item" data-view="videos">
            <i class="bi bi-play-circle"></i>
            <span>Tutoriels vidéo</span>
        </a>
        <a class="sidebar-item" data-view="contributed">
            <i class="bi bi-people"></i>
            <span>Contenu contribué</span>
        </a>
        <a class="sidebar-item" data-view="documents">
            <i class="bi bi-file-earmark-text"></i>
            <span>Documents</span>
        </a>
        <a class="sidebar-item" data-view="assignments">
            <i class="bi bi-clipboard-check"></i>
            <span>Devoirs</span>
        </a>
        <a class="sidebar-item" data-view="calendar">
            <i class="bi bi-calendar-event"></i>
            <span>Calendrier</span>
        </a>

        <div class="p-3 mt-3">
            <h6 class="text-muted text-uppercase" style="font-size:11px; letter-spacing:1px">Outils</h6>
        </div>

        <a class="sidebar-item" data-view="notes">
            <i class="bi bi-journal-text"></i>
            <span>Mes notes</span>
        </a>
        <a class="sidebar-item" data-view="progress">
            <i class="bi bi-graph-up"></i>
            <span>Suivi des progrès</span>
        </a>
        <a class="sidebar-item" data-view="settings">
            <i class="bi bi-gear"></i>
            <span>Paramètres</span>
        </a>
    </aside>

    <!-- Main Content -->
    <main class="main-content" id="mainContent">
        <!-- Tableau de bord View -->
        <div id="dashboardView" class="view-content">
            <div class="d-flex justify-content-between align-items-center mb-4">
                <div>
                    <h2 style="color:var(--brand); font-weight:700">
                        Bienvenue de retour, <span id="welcomeUserName" style="color:var(--accent)"></span> !
                    </h2>

                    <p class="text-muted">Continuez votre parcours d'apprentissage</p>
                </div>
                <div class="d-flex gap-2">
                    <select class="form-select" id="semesterFilter">
                        <option>Tous les semestres</option>
                        <option>Semestre 1</option>
                        <option>Semestre 2</option>
                    </select>
                </div>
            </div>

            <!-- Stats -->
            <div class="row g-4 mb-4">
                <div class="col-md-3">
                    <div class="stat-card">
                        <i class="bi bi-book"></i>
                        <div style="position:relative; z-index:1">
                            <small style="opacity:0.9">Total des cours</small>
                            <h3 id="totalCourses">0</h3>
                        </div>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="stat-card" style="background:linear-gradient(135deg, var(--success), #20c997)">
                        <i class="bi bi-check-circle"></i>
                        <div style="position:relative; z-index:1">
                            <small style="opacity:0.9">Complétés</small>
                            <h3 id="completedCourses">0</h3>
                        </div>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="stat-card" style="background:linear-gradient(135deg, var(--accent), #e6c84f)">
                        <i class="bi bi-clock-history"></i>
                        <div style="position:relative; z-index:1">
                            <small style="opacity:0.9">En cours</small>
                            <h3 id="inProgressCourses">0</h3>
                        </div>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="stat-card" style="background:linear-gradient(135deg, #6f42c1, #8b5cf6)">
                        <i class="bi bi-trophy"></i>
                        <div style="position:relative; z-index:1">
                            <small style="opacity:0.9">Score d'accomplissement</small>
                            <h3>85%</h3>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Continuer l'apprentissage -->
            <div class="card card-modern mb-4">
                <div class="card-body">
                    <h5 class="mb-3"><i class="bi bi-play-circle me-2"></i>Continuer l'apprentissage</h5>
                    <div class="row g-3" id="continueSection">
                        <div class="col-12 text-center text-muted py-4">
                            <i class="bi bi-folder2-open fs-1"></i>
                            <p class="mt-2">Chargement de vos cours...</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Activité récente -->
            <div class="row g-4">
                <div class="col-lg-8">
                    <div class="card card-modern">
                        <div class="card-body">
                            <h5 class="mb-4"><i class="bi bi-clock-history me-2"></i>Activité récente</h5>
                            <div id="activityTimeline">
                                <div class="timeline-item">
                                    <div class="timeline-dot"><i class="bi bi-check"></i></div>
                                    <div>
                                        <strong>Complété : Module de conception d'algorithmes</strong>
                                        <p class="text-muted small mb-0">Il y a 2 heures</p>
                                    </div>
                                </div>
                                <div class="timeline-item">
                                    <div class="timeline-dot"><i class="bi bi-file-earmark"></i></div>
                                    <div>
                                        <strong>Téléchargé : Notes de cours sur les structures de données</strong>
                                        <p class="text-muted small mb-0">Hier</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="col-lg-4">
                    <div class="card card-modern">
                        <div class="card-body">
                            <h5 class="mb-4"><i class="bi bi-calendar-event me-2"></i>À venir</h5>
                            <div class="d-flex flex-column gap-3">
                                <div class="d-flex gap-3 align-items-center">
                                    <div class="bg-primary text-white p-2 rounded"
                                        style="min-width:48px; text-align:center">
                                        <div style="font-size:20px; font-weight:700">18</div>
                                        <div style="font-size:10px">OCT</div>
                                    </div>
                                    <div>
                                        <strong style="font-size:14px">Examen de base de données</strong>
                                        <p class="text-muted small mb-0">10:00</p>
                                    </div>
                                </div>
                                <div class="d-flex gap-3 align-items-center">
                                    <div class="bg-warning text-white p-2 rounded"
                                        style="min-width:48px; text-align:center">
                                        <div style="font-size:20px; font-weight:700">20</div>
                                        <div style="font-size:10px">OCT</div>
                                    </div>
                                    <div>
                                        <strong style="font-size:14px">Soumission de projet</strong>
                                        <p class="text-muted small mb-0">23:59</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Tous les cours View -->
        <div id="coursesView" class="view-content d-none">
            <div id="breadcrumb" class="mb-3"></div>
            <div class="d-flex justify-content-between align-items-center mb-4">
                <h2 style="color:var(--brand); font-weight:700">Tous les cours</h2>
                <div class="d-flex gap-2">
                    <select class="form-select" id="categoryFilter">
                        <option value="all">Toutes les catégories</option>
                        <option value="video">Vidéos</option>
                        <option value="document">Documents</option>
                        <option value="folder">Dossiers</option>
                    </select>
                    <select class="form-select" id="sortBy">
                        <option>Trier par nom</option>
                        <option>Trier par date</option>
                        <option>Trier par type</option>
                    </select>
                </div>
            </div>

            <div id="loader" class="py-5 text-center">
                <div class="loader"></div>
                <div class="mt-3 text-muted">Chargement des cours depuis Drive...</div>
            </div>

            <div class="row g-4" id="coursesGrid"></div>
            <div class="card card-modern mt-4 d-none" id="folderContributedSection">
                <div class="card-body">
                    <h5 class="mb-3">Tutoriels contribués pour ce cours</h5>
                    <div class="row g-4" id="folderContributedGrid"></div>
                </div>
            </div>
        </div>

        <!-- Tutoriels vidéo View -->
        <div id="videosView" class="view-content d-none">
            <h2 class="mb-4" style="color:var(--brand); font-weight:700">Tutoriels vidéo</h2>
            <div class="row g-4" id="videosGrid"></div>
            <div class="card card-modern mt-4">
                <div class="card-body">
                    <h5 class="mb-3">Tutoriels YouTube recommandés</h5>
                    <div class="row g-4" id="youtubeVideosGrid"></div>
                </div>
            </div>
            <div class="card card-modern mt-4">
                <div class="card-body">
                    <h5 class="mb-3">Tutoriels contribués</h5>
                    <div class="row g-4" id="contributedVideosGrid"></div>
                </div>
            </div>
        </div>

        <!-- Contenu contribué View -->
        <div id="contributedView" class="view-content d-none">
            <h2 class="mb-4" style="color:var(--brand); font-weight:700">Contenu contribué</h2>
            <form id="addContentForm" class="mb-4">
                <div class="mb-3">
                    <input id="contentUrl" class="form-control" placeholder="URL YouTube (vidéo ou playlist)" required>
                </div>
                <div class="mb-3">
                    <input id="contentTitle" class="form-control" placeholder="Titre (optionnel)">
                </div>
                <div class="mb-3">
                    <select id="contentCourse" class="form-select">
                        <option value="">Associé à aucun cours</option>
                    </select>
                </div>
                <button class="btn btn-primary" type="submit">Ajouter contenu</button>
            </form>
            <div class="row g-4" id="contributedGrid"></div>
        </div>

        <!-- Documents View -->
        <div id="documentsView" class="view-content d-none">
            <h2 class="mb-4" style="color:var(--brand); font-weight:700">Documents & Matériaux</h2>
            <div class="row g-4" id="documentsGrid"></div>
        </div>

        <!-- Devoirs View -->
        <div id="assignmentsView" class="view-content d-none">
            <h2 class="mb-4" style="color:var(--brand); font-weight:700">Devoirs</h2>
            <div class="row g-4" id="assignmentsGrid"></div>
        </div>

        <!-- Calendrier View -->
        <div id="calendarView" class="view-content d-none">
            <h2 class="mb-4" style="color:var(--brand); font-weight:700">Calendrier</h2>
            <div class="card card-modern">
                <div class="card-body">
                    <div id="calendarEvents"></div>
                </div>
            </div>
        </div>

        <!-- Mes notes View -->
        <div id="notesView" class="view-content d-none">
            <h2 class="mb-4" style="color:var(--brand); font-weight:700">Mes notes</h2>
            <form id="noteForm" class="mb-4">
                <div class="mb-3">
                    <input id="noteTitle" class="form-control" placeholder="Titre de la note" required>
                </div>
                <div class="mb-3">
                    <textarea id="noteContent" class="form-control" rows="4" placeholder="Contenu de la note"
                        required></textarea>
                </div>
                <button class="btn btn-primary" type="submit">Ajouter une note</button>
            </form>
            <div id="notesList" class="row g-4"></div>
        </div>

        <!-- Suivi des progrès View -->
        <div id="progressView" class="view-content d-none">
            <h2 class="mb-4" style="color:var(--brand); font-weight:700">Suivi des progrès</h2>
            <div class="card card-modern">
                <div class="card-body">
                    <canvas id="progressChart" height="200"></canvas>
                </div>
            </div>
        </div>

        <!-- Paramètres View -->
        <div id="settingsView" class="view-content d-none">
            <h2 class="mb-4" style="color:var(--brand); font-weight:700">Paramètres</h2>
            <div class="card card-modern">
                <div class="card-body">
                    <div class="mb-3">
                        <label for="themeSelect" class="form-label">Thème</label>
                        <select id="themeSelect" class="form-select">
                            <option value="light">Clair</option>
                            <option value="dark">Sombre</option>
                            <option value="modern">Moderne</option>
                            <option value="pastel">Pastel</option>
                            <option value="system">Système</option>
                        </select>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- Vidéo Modal -->
    <div class="modal fade video-modal" id="videoModal" tabindex="-1">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="videoTitle">Tutoriel vidéo</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body p-0">
                    <div class="video-container" id="videoContainer"></div>
                </div>
                <div class="modal-body">
                    <div id="videoDescription" class="text-muted"></div>
                    <div class="mt-3">
                        <button class="btn btn-sm btn-outline-primary me-2"><i class="bi bi-bookmark"></i>
                            Enregistrer</button>
                        <button class="btn btn-sm btn-outline-secondary"><i class="bi bi-share"></i> Partager</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Document Modal -->
    <div class="modal fade document-modal" id="documentModal" tabindex="-1">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="documentTitle">Document</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body p-0">
                    <div class="document-container" id="documentContainer"></div>
                </div>
            </div>
        </div>
    </div>

    <!-- Auth Modal -->
    <div class="modal fade" id="modalAuth" tabindex="-1">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header">
                    <ul class="nav nav-tabs nav-tabs-modern w-100">
                        <li class="nav-item">
                            <button class="nav-link active" id="signinTab" data-bs-toggle="tab"
                                data-bs-target="#signin">Se connecter</button>
                        </li>
                        <li class="nav-item">
                            <button class="nav-link" id="signupTab" data-bs-toggle="tab" data-bs-target="#signup">Créer
                                un compte</button>
                        </li>
                    </ul>
                </div>
                <div class="modal-body p-4">
                    <div class="tab-content">
                        <div class="tab-pane fade show active" id="signin">
                            <h4 class="text-center mb-4" style="color:var(--brand)">Connectez-vous à votre compte</h4>

                            <button id="googleSignIn" class="btn btn-outline-dark w-100 mb-3 py-2">
                                <i class="bi bi-google me-2"></i> Continuer avec Google
                            </button>

                            <div class="text-center my-3 text-muted">ou</div>

                            <form id="signinForm">
                                <div class="mb-3">
                                    <input id="signinEmail" type="email" class="form-control"
                                        placeholder="Adresse email" required>
                                </div>
                                <div class="mb-3">
                                    <input id="signinPassword" type="password" class="form-control"
                                        placeholder="Mot de passe" required>
                                </div>
                                <button class="btn btn-primary w-100 py-2" type="submit">Se connecter</button>
                            </form>
                        </div>

                        <div class="tab-pane fade" id="signup">
                            <h4 class="text-center mb-4" style="color:var(--brand)">Créer un nouveau compte</h4>

                            <button id="googleSignup" class="btn btn-outline-dark w-100 mb-3 py-2">
                                <i class="bi bi-google me-2"></i> S'inscrire avec Google
                            </button>

                            <div class="text-center my-3 text-muted">ou</div>

                            <form id="signupForm">
                                <div class="mb-3">
                                    <input id="signupName" type="text" class="form-control" placeholder="Nom complet"
                                        required>
                                </div>
                                <div class="mb-3">
                                    <input id="signupEmail" type="email" class="form-control"
                                        placeholder="Adresse email" required>
                                </div>
                                <div class="mb-3">
                                    <input id="signupPassword" type="password" class="form-control"
                                        placeholder="Mot de passe" required>
                                </div>
                                <button class="btn btn-primary w-100 py-2" type="submit">Créer un compte</button>
                            </form>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script type="module">
        const DRIVE_API_KEY = 'AIzaSyAcOuFc10xwtujaClC_TZckrGkKx3h0iNI';
        const DRIVE_FOLDER_ID = '1rWQnAn8e2fLPpGa-8_GXYHmb0NeTLNH2';
        const YOUTUBE_API_KEY = 'AIzaSyAcOuFc10xwtujaClC_TZckrGkKx3h0iNI'; // Remplacer par une clé valide

        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.14.0/firebase-app.js";
        import {
            getAuth,
            GoogleAuthProvider,
            signInWithPopup,
            signInWithEmailAndPassword,
            createUserWithEmailAndPassword,
            signOut,
            onAuthStateChanged,
            updateProfile
        } from "https://www.gstatic.com/firebasejs/10.14.0/firebase-auth.js";
        import { getFirestore, collection, addDoc, getDocs, query, where } from "https://www.gstatic.com/firebasejs/10.14.0/firebase-firestore.js";

        const firebaseConfig = {
            apiKey: "AIzaSyAgl557z1SyRSljc3UpIUELUpr2SM0SkBs",
            authDomain: "informatique-et-ia-fpn.firebaseapp.com",
            projectId: "informatique-et-ia-fpn",
            storageBucket: "informatique-et-ia-fpn.firebasestorage.app",
            messagingSenderId: "588259713629",
            appId: "1:588259713629:web:b4687934056edd5207e3b4",
            measurementId: "G-TG8DP35DG6"
        };

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);
        const provider = new GoogleAuthProvider();

        let allFiles = [];
        let currentFiles = [];
        let userProgress = {};
        let currentFolderId = DRIVE_FOLDER_ID;
        let folderPath = [{ id: DRIVE_FOLDER_ID, name: 'Racine' }];
        let notes = JSON.parse(localStorage.getItem('notes') || '[]');
        let contributedContent = [];

        // Éléments DOM
        const btnLogin = document.getElementById('btnLogin');
        const btnLogout = document.getElementById('btnLogout');
        const modalAuth = new bootstrap.Modal(document.getElementById('modalAuth'));
        const videoModal = new bootstrap.Modal(document.getElementById('videoModal'));
        const documentModal = new bootstrap.Modal(document.getElementById('documentModal'));
        const sidebarToggle = document.getElementById('sidebarToggle');
        const sidebar = document.getElementById('sidebar');
        const mainContent = document.getElementById('mainContent');
        const contentCourseSelect = document.getElementById('contentCourse');

        // Initialisation
        document.querySelectorAll('.sidebar-item').forEach(item => {
            item.addEventListener('click', () => {
                const view = item.dataset.view;
                switchView(view);
                document.querySelectorAll('.sidebar-item').forEach(i => i.classList.remove('active'));
                item.classList.add('active');
                if (window.innerWidth < 992) sidebar.classList.remove('show');
            });
        });

        sidebarToggle?.addEventListener('click', () => {
            sidebar.classList.toggle('show');
        });

        btnLogin.addEventListener('click', () => modalAuth.show());

        document.getElementById('googleSignIn').addEventListener('click', async () => {
            try {
                await signInWithPopup(auth, provider);
                modalAuth.hide();
            } catch (err) {
                alert('Erreur de connexion : ' + err.message);
            }
        });

        document.getElementById('googleSignup').addEventListener('click', async () => {
            try {
                const result = await signInWithPopup(auth, provider);
                await updateProfile(result.user, { displayName: result.user.displayName });
                modalAuth.hide();
            } catch (err) {
                alert('Erreur d\'inscription : ' + err.message);
            }
        });

        document.getElementById('signinForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            const email = document.getElementById('signinEmail').value;
            const password = document.getElementById('signinPassword').value;
            try {
                await signInWithEmailAndPassword(auth, email, password);
                modalAuth.hide();
            } catch (err) {
                alert('Erreur de connexion : ' + err.message);
            }
        });

        document.getElementById('signupForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            const name = document.getElementById('signupName').value;
            const email = document.getElementById('signupEmail').value;
            const password = document.getElementById('signupPassword').value;
            try {
                const result = await createUserWithEmailAndPassword(auth, email, password);
                await updateProfile(result.user, { displayName: name });
                modalAuth.hide();
            } catch (err) {
                alert('Erreur d\'inscription : ' + err.message);
            }
        });

        btnLogout.addEventListener('click', async () => {
            await signOut(auth);
            location.reload();
        });

        /*onAuthStateChanged(auth, (user) => {
            if (user) {
                document.getElementById('userBox').classList.remove('d-none');
                document.getElementById('userPhoto').src = user.photoURL || `https://ui-avatars.com/api/?name=${encodeURIComponent(user.displayName || user.email)}`;
                document.getElementById('userName').innerText = user.displayName || 'Utilisateur';
                document.getElementById('userEmail').innerText = user.email;
                btnLogin.classList.add('d-none');
                btnLogout.classList.remove('d-none');
                loadUserProgress();
                fetchDriveFolder(currentFolderId);
                loadContributedContent();
            } else {
                fetchDriveFolder(currentFolderId);
            }
            loadTheme();
        });
        */
        onAuthStateChanged(auth, (user) => {
            const profileDropdown = document.getElementById('profileDropdown');
            const btnLogin = document.getElementById('btnLogin');

            if (user) {
                profileDropdown.style.display = 'block';
                btnLogin.classList.add('d-none');

                document.getElementById('userPhoto').src =
                    user.photoURL || `https://ui-avatars.com/api/?name=${encodeURIComponent(user.displayName || user.email)}`;
                document.getElementById('userName').innerText = user.displayName || 'Utilisateur';
                document.getElementById('userEmail').innerText = user.email;

                loadUserProgress();
                fetchDriveFolder(currentFolderId);
                loadContributedContent();
            } else {
                profileDropdown.style.display = 'none';
                btnLogin.classList.remove('d-none');
                fetchDriveFolder(currentFolderId);
            }

            loadTheme();
        });

        // Recherche
        document.getElementById('searchInput')?.addEventListener('input', (e) => {
            const query = e.target.value.toLowerCase();
            filterCourses(query);
        });

        // Formulaire de notes
        document.getElementById('noteForm')?.addEventListener('submit', (e) => {
            e.preventDefault();
            const title = document.getElementById('noteTitle').value;
            const content = document.getElementById('noteContent').value;
            notes.push({ title, content, date: new Date().toLocaleString('fr-FR') });
            localStorage.setItem('notes', JSON.stringify(notes));
            renderNotes();
            e.target.reset();
        });

        // Formulaire ajouter contenu
        document.getElementById('addContentForm')?.addEventListener('submit', async (e) => {
            e.preventDefault();
            const url = document.getElementById('contentUrl').value;
            const title = document.getElementById('contentTitle').value || '';
            const courseId = document.getElementById('contentCourse').value;
            const type = url.includes('list=') ? 'playlist' : 'video';
            const id = extractYoutubeId(url, type);
            if (id) {
                try {
                    await addDoc(collection(db, 'contributed'), {
                        type,
                        id,
                        title,
                        courseId,
                        userId: auth.currentUser.uid,
                        userName: auth.currentUser.displayName || 'Anonyme',
                        createdAt: new Date()
                    });
                    loadContributedContent();
                    e.target.reset();
                } catch (err) {
                    alert('Erreur : ' + err.message);
                }
            } else {
                alert('URL YouTube invalide');
            }
        });

        // Sélecteur de thème
        document.getElementById('themeSelect')?.addEventListener('change', (e) => {
            const theme = e.target.value;
            setTheme(theme);
        });

        function switchView(view) {
            document.querySelectorAll('.view-content').forEach(v => v.classList.add('d-none'));
            const viewEl = document.getElementById(`${view}View`);
            if (viewEl) viewEl.classList.remove('d-none');

            if (view === 'videos') {
                renderVideos();
                fetchYoutubeTutorials();
                renderContributedVideos();
            }
            if (view === 'contributed') renderContributed();
            if (view === 'documents') renderDocuments();
            if (view === 'assignments') renderAssignments();
            if (view === 'calendar') renderCalendar();
            if (view === 'notes') renderNotes();
            if (view === 'progress') renderProgress();
            if (view === 'settings') renderSettings();
        }

        function loadUserProgress() {
            const saved = localStorage.getItem('userProgress');
            if (saved) userProgress = JSON.parse(saved);
        }

        function saveProgress(fileId, progress) {
            userProgress[fileId] = progress;
            localStorage.setItem('userProgress', JSON.stringify(userProgress));
            updateStats();
        }

        async function fetchDriveFolder(folderId) {
            document.getElementById('loader').style.display = 'block';

            try {
                const keyParam = DRIVE_API_KEY ? `&key=${DRIVE_API_KEY}` : '';
                const url = `https://www.googleapis.com/drive/v3/files?q='${folderId}'+in+parents&fields=files(id,name,mimeType,webViewLink,thumbnailLink,iconLink,webContentLink,description,createdTime,modifiedTime)&pageSize=200${keyParam}`;

                const res = await fetch(url);
                const json = await res.json();

                if (json.error) {
                    console.error('Erreur API Drive', json.error);
                    document.getElementById('loader').style.display = 'none';
                    return;
                }

                currentFiles = json.files || [];
                if (folderId === DRIVE_FOLDER_ID) allFiles = currentFiles;
                document.getElementById('loader').style.display = 'none';

                renderCourses();
                renderFolderContributed();
                renderDashboard();
                updateStats();
                renderBreadcrumb();
                populateCourseSelect();
            } catch (err) {
                console.error('Erreur de fetch', err);
                document.getElementById('loader').style.display = 'none';
            }
        }

        function populateCourseSelect() {
            contentCourseSelect.innerHTML = '<option value="">Associé à aucun cours</option>';
            allFiles.filter(f => f.mimeType === 'application/vnd.google-apps.folder').forEach(folder => {
                const option = document.createElement('option');
                option.value = folder.id;
                option.textContent = folder.name;
                contentCourseSelect.appendChild(option);
            });
        }

        async function loadContributedContent() {
            contributedContent = [];
            const q = query(collection(db, 'contributed'));
            const snapshot = await getDocs(q);
            snapshot.forEach(doc => contributedContent.push({ id: doc.id, ...doc.data() }));
            renderContributed();
        }

        function getFileMeta(mime) {
            if (!mime) return { kind: 'file', icon: 'bi-file-earmark-text', label: 'Fichier', color: '#6c757d' };
            if (mime === 'application/vnd.google-apps.folder') return { kind: 'folder', icon: 'bi-folder-fill', label: 'Dossier', color: '#ffc107' };
            if (mime.startsWith('video/')) return { kind: 'video', icon: 'bi-camera-video-fill', label: 'Vidéo', color: '#dc3545' };
            if (mime === 'application/pdf') return { kind: 'document', icon: 'bi-file-earmark-pdf-fill', label: 'PDF', color: '#0d6efd' };
            if (mime.includes('document')) return { kind: 'document', icon: 'bi-file-earmark-text-fill', label: 'Document', color: '#0d6efd' };
            if (mime.includes('spreadsheet')) return { kind: 'document', icon: 'bi-file-earmark-spreadsheet', label: 'Tableur', color: '#198754' };
            if (mime.includes('presentation')) return { kind: 'document', icon: 'bi-file-earmark-slides', label: 'Présentation', color: '#fd7e14' };
            return { kind: 'file', icon: 'bi-file-earmark', label: 'Fichier', color: '#6c757d' };
        }

        function extractVideoId(url) {
            if (!url) return null;
            const match = url.match(/(?:youtube\.com\/(?:[^\/]+\/.+\/|(?:v|e(?:mbed)?)\/|.*[?&]v=)|youtu\.be\/)([^"&?\/\s]{11})/);
            return match ? match[1] : null;
        }

        function extractPlaylistId(url) {
            const match = url.match(/[&?]list=([a-zA-Z0-9_-]+)/);
            return match ? match[1] : null;
        }

        function extractYoutubeId(url, type) {
            return type === 'playlist' ? extractPlaylistId(url) : extractVideoId(url);
        }

        function renderBreadcrumb() {
            const breadcrumb = document.getElementById('breadcrumb');
            if (!breadcrumb) return;
            breadcrumb.innerHTML = folderPath.map((folder, index) => {
                return index === folderPath.length - 1 ?
                    `<span>${escapeHtml(folder.name)}</span>` :
                    `<a href="#" onclick="navigateToFolder('${folder.id}', ${index})">${escapeHtml(folder.name)}</a> > `;
            }).join('');
        }

        window.navigateToFolder = function (folderId, index) {
            folderPath = folderPath.slice(0, index + 1);
            currentFolderId = folderId;
            fetchDriveFolder(folderId);
        };

        function renderCourses() {
            const grid = document.getElementById('coursesGrid');
            grid.innerHTML = '';

            if (!currentFiles.length) {
                grid.innerHTML = '<div class="col-12 text-center text-muted py-5"><i class="bi bi-inbox fs-1"></i><p class="mt-2">Aucun cours trouvé</p></div>';
                return;
            }

            currentFiles.forEach(file => {
                const meta = getFileMeta(file.mimeType);
                const progress = userProgress[file.id] || 0;
                const thumb = file.thumbnailLink || `https://via.placeholder.com/400x250/${meta.color.replace('#', '')}/ffffff?text=${encodeURIComponent(meta.label)}`;

                const col = document.createElement('div');
                col.className = 'col-xl-3 col-lg-4 col-md-6';
                col.innerHTML = `
        <div class="card card-modern course-card h-100 fade-in">
          ${progress > 0 ? `<div class="progress-ring">${progress}%</div>` : ''}
          <span class="course-badge"><i class="${meta.icon} me-1"></i>${meta.label}</span>
          ${meta.kind === 'folder' ?
                        `<div class="course-thumbnail d-flex align-items-center justify-content-center" style="background:linear-gradient(135deg, ${meta.color}22, ${meta.color}11)">
              <i class="${meta.icon}" style="font-size:64px; color:${meta.color}"></i>
            </div>` :
                        `<img class="course-thumbnail" src="${thumb}" alt="${escapeHtml(file.name)}" loading="lazy">`
                    }
          <div class="card-body d-flex flex-column">
            <h6 class="card-title mb-2" style="min-height:44px; line-height:1.4">${escapeHtml(file.name)}</h6>
            ${file.description ? `<p class="small text-muted mb-3">${escapeHtml(file.description.substring(0, 80))}...</p>` : ''}
            ${progress > 0 ? `
              <div class="progress mb-3" style="height:6px">
                <div class="progress-bar bg-success" style="width:${progress}%"></div>
              </div>` : ''}
            <div class="mt-auto d-grid gap-2">
              ${meta.kind === 'folder' ?
                        `<button class="btn btn-sm btn-primary" onclick="openFolder('${file.id}', '${escapeHtml(file.name)}')">
                  <i class="bi bi-folder-symlink me-1"></i>Ouvrir
                </button>` :
                        (meta.kind === 'video' ?
                            `<button class="btn btn-sm btn-primary" onclick="playVideo('${file.id}', '${escapeHtml(file.name)}', '${file.webViewLink || ''}')">
                    <i class="bi bi-play-fill me-1"></i>Regarder
                  </button>` :
                            `<button class="btn btn-sm btn-primary" onclick="viewDocument('${file.id}', '${escapeHtml(file.name)}', '${file.webViewLink || ''}', '${meta.kind}')">
                    <i class="bi bi-eye me-1"></i>Voir
                  </button>`
                        )
                    }
              ${file.webContentLink ?
                        `<a class="btn btn-sm btn-outline-secondary" href="${file.webContentLink}" target="_blank">
                  <i class="bi bi-download me-1"></i>Télécharger
                </a>` : ''}
              <button class="btn btn-sm btn-outline-success" onclick="markComplete('${file.id}')">
                <i class="bi bi-check-circle me-1"></i>${progress === 100 ? 'Complété' : 'Marquer comme complété'}
              </button>
            </div>
          </div>
        </div>
      `;
                grid.appendChild(col);
            });
        }

        function renderFolderContributed() {
            const section = document.getElementById('folderContributedSection');
            if (!section) return;
            if (currentFolderId === DRIVE_FOLDER_ID) {
                section.classList.add('d-none');
                return;
            }

            section.classList.remove('d-none');
            const grid = document.getElementById('folderContributedGrid');
            grid.innerHTML = '';

            const filtered = contributedContent.filter(c => c.courseId === currentFolderId);

            if (!filtered.length) {
                grid.innerHTML = `
      <div class="col-12 text-center text-muted py-5">
        <i class="bi bi-camera-video-off fs-2 d-block mb-2"></i>
        Aucun tutoriel contribué
      </div>`;
                return;
            }

            filtered.forEach(content => {
                const col = document.createElement('div');
                col.className = 'col-md-4 col-sm-6 mb-4';

                const thumbnailUrl =
                    content.type === 'playlist'
                        ? 'https://img.icons8.com/fluency/96/youtube-playlist.png'
                        : `https://img.youtube.com/vi/${content.id}/mqdefault.jpg`;

                col.innerHTML = `
      <div class="video-card fade-in" onclick="playYoutube('${content.type}', '${content.id}', '${escapeHtml(content.title)}')">
        <div class="video-thumb">
          <img src="${thumbnailUrl}" alt="${escapeHtml(content.title)}" class="video-thumb-img">
          <div class="video-overlay">
            <i class="bi bi-play-fill play-icon"></i>
          </div>
          <span class="video-badge">${content.type.charAt(0).toUpperCase() + content.type.slice(1)}</span>
        </div>
        <div class="video-body">
          <h6 class="video-title">${escapeHtml(content.title || 'Sans titre')}</h6>
          <p class="video-author">
            <i class="bi bi-person-circle me-1"></i>${escapeHtml(content.userName || 'Inconnu')}
          </p>
        </div>
      </div>`;
                grid.appendChild(col);
            });
        }

        function renderDashboard() {
            const continueSection = document.getElementById('continueSection');
            const inProgress = allFiles.filter(f => {
                const prog = userProgress[f.id] || 0;
                return prog > 0 && prog < 100;
            }).slice(0, 3);

            if (!inProgress.length) {
                continueSection.innerHTML = `
        <div class="col-12 text-center text-muted py-3">
          <i class="bi bi-play-circle fs-1"></i>
          <p class="mt-2">Commencez un cours pour le voir ici</p>
        </div>`;
                return;
            }

            continueSection.innerHTML = '';
            inProgress.forEach(file => {
                const meta = getFileMeta(file.mimeType);
                const progress = userProgress[file.id] || 0;

                const col = document.createElement('div');
                col.className = 'col-md-4';
                col.innerHTML = `
        <div class="card border-0 bg-light fade-in">
          <div class="card-body">
            <div class="d-flex gap-3">
              <div class="text-primary" style="font-size:32px">
                <i class="${meta.icon}"></i>
              </div>
              <div class="flex-grow-1">
                <h6 class="mb-1">${escapeHtml(file.name)}</h6>
                <small class="text-muted">${meta.label}</small>
                <div class="progress mt-2" style="height:6px">
                  <div class="progress-bar" style="width:${progress}%"></div>
                </div>
                <small class="text-muted">${progress}% complété</small>
              </div>
            </div>
            <button class="btn btn-sm btn-primary w-100 mt-3" onclick="resumeCourse('${file.id}')">
              <i class="bi bi-play-fill me-1"></i>Continuer
            </button>
          </div>
        </div>
      `;
                continueSection.appendChild(col);
            });
        }

        function renderVideos() {
            const grid = document.getElementById('videosGrid');
            const videos = allFiles.filter(f => f.mimeType?.startsWith('video/'));

            grid.innerHTML = '';
            if (!videos.length) {
                grid.innerHTML = '<div class="col-12 text-center text-muted py-5"><i class="bi bi-camera-video fs-1"></i><p class="mt-2">Aucune vidéo trouvée</p></div>';
                return;
            }

            videos.forEach(file => {
                const progress = userProgress[file.id] || 0;
                const col = document.createElement('div');
                col.className = 'col-lg-6 col-xl-4';
                col.innerHTML = `
        <div class="card card-modern h-100 fade-in">
          <div class="position-relative">
            <img src="${file.thumbnailLink || 'https://via.placeholder.com/400x225/dc3545/ffffff?text=Vidéo'}" class="course-thumbnail w-100" alt="${escapeHtml(file.name)}">
            <div class="position-absolute top-50 start-50 translate-middle">
              <button class="btn btn-danger btn-lg rounded-circle" style="width:64px; height:64px" onclick="playVideo('${file.id}', '${escapeHtml(file.name)}', '${file.webViewLink || ''}')">
                <i class="bi bi-play-fill fs-3"></i>
              </button>
            </div>
            ${progress > 0 ? `<div class="progress-ring">${progress}%</div>` : ''}
          </div>
          <div class="card-body">
            <h6>${escapeHtml(file.name)}</h6>
            ${progress > 0 ? `
              <div class="progress mt-2" style="height:6px">
                <div class="progress-bar bg-danger" style="width:${progress}%"></div>
              </div>` : ''}
            <div class="d-flex gap-2 mt-3">
              <button class="btn btn-sm btn-outline-primary flex-grow-1" onclick="playVideo('${file.id}', '${escapeHtml(file.name)}', '${file.webViewLink || ''}')">
                <i class="bi bi-play me-1"></i>Regarder
              </button>
              <button class="btn btn-sm btn-outline-secondary" onclick="saveForLater('${file.id}')">
                <i class="bi bi-bookmark"></i>
              </button>
            </div>
          </div>
        </div>
      `;
                grid.appendChild(col);
            });
        }

        async function fetchYoutubeTutorials() {
            const grid = document.getElementById('youtubeVideosGrid');
            grid.innerHTML = '<div class="col-12 text-center"><div class="loader"></div></div>';

            try {
                const queries = allFiles.filter(f => f.mimeType === 'application/vnd.google-apps.folder').map(f => f.name + ' tutorial');
                const results = [];
                for (const q of queries) {
                    const url = `https://www.googleapis.com/youtube/v3/search?part=snippet&q=${encodeURIComponent(q)}&type=video,playlist&maxResults=5&key=${YOUTUBE_API_KEY}`;
                    const res = await fetch(url);
                    const json = await res.json();
                    results.push(...(json.items || []));
                }
                renderYoutubeResults(results);
            } catch (err) {
                grid.innerHTML = '<div class="col-12 text-center text-muted">Erreur de chargement des tutoriels YouTube</div>';
            }
        }

        function renderYoutubeResults(items) {
            const grid = document.getElementById('youtubeVideosGrid');
            grid.innerHTML = '';
            items.forEach(item => {
                const isPlaylist = item.id.kind === 'youtube#playlist';
                const id = isPlaylist ? item.id.playlistId : item.id.videoId;
                const type = isPlaylist ? 'playlist' : 'video';
                const thumb = item.snippet.thumbnails?.medium?.url || 'https://via.placeholder.com/320x180';
                const col = document.createElement('div');
                col.className = 'col-md-4';
                col.innerHTML = `
        <div class="card card-modern h-100 fade-in">
          <div class="position-relative">
            <img src="${thumb}" class="card-img-top" alt="${escapeHtml(item.snippet.title)}">
            <div class="position-absolute top-50 start-50 translate-middle">
              <button class="btn btn-danger rounded-circle" onclick="playYoutube('${type}', '${id}', '${escapeHtml(item.snippet.title)}')">
                <i class="bi bi-play-fill fs-4"></i>
              </button>
            </div>
          </div>
          <div class="card-body">
            <h6 class="card-title">${escapeHtml(item.snippet.title)}</h6>
            <small class="text-muted">${item.snippet.channelTitle}</small>
          </div>
        </div>
      `;
                grid.appendChild(col);
            });
        }

        function displayUserInfo(user) {
            const nameEl = document.getElementById('userName');
            const photoEl = document.getElementById('userPhoto');
            const emailEl = document.getElementById('userEmail');
            const welcomeEl = document.getElementById('welcomeUserName');

            if (user) {
                // set avatar and dropdown info
                nameEl.textContent = user.name || '';
                emailEl.textContent = user.email || '';
                if (photoEl) photoEl.src = user.photoURL || 'https://via.placeholder.com/40';

                // 👇 Set welcome message name
                if (welcomeEl) {
                    welcomeEl.textContent = user.name || 'Utilisateur';
                }

                document.getElementById('profileDropdown').style.display = 'block';
                document.getElementById('btnLogin').classList.add('d-none');
                document.getElementById('btnLogout').classList.remove('d-none');
            } else {
                if (welcomeEl) welcomeEl.textContent = '';
                document.getElementById('profileDropdown').style.display = 'none';
                document.getElementById('btnLogin').classList.remove('d-none');
                document.getElementById('btnLogout').classList.add('d-none');
            }
        }


        function renderContributedVideos() {
            const grid = document.getElementById('contributedVideosGrid');
            grid.innerHTML = '';
            contributedContent.forEach(content => {
                const col = document.createElement('div');
                col.className = 'col-md-4';
                col.innerHTML = `
        <div class="card card-modern h-100 fade-in">
          <div class="position-relative">
            <img src="https://img.youtube.com/vi/${content.type === 'playlist' ? '' : content.id}/mqdefault.jpg" class="card-img-top" alt="${escapeHtml(content.title)}">
            <div class="position-absolute top-50 start-50 translate-middle">
              <button class="btn btn-danger rounded-circle" onclick="playYoutube('${content.type}', '${content.id}', '${escapeHtml(content.title)}')">
                <i class="bi bi-play-fill fs-4"></i>
              </button>
            </div>
          </div>
          <div class="card-body">
            <h6 class="card-title">${escapeHtml(content.title || 'Sans titre')}</h6>
            <small class="text-muted">${content.type.charAt(0).toUpperCase() + content.type.slice(1)} - Par ${escapeHtml(content.userName)}</small>
          </div>
        </div>
      `;
                grid.appendChild(col);
            });
        }

        function renderContributed() {
            const grid = document.getElementById('contributedGrid');
            grid.innerHTML = '';
            contributedContent.forEach(content => {
                const col = document.createElement('div');
                col.className = 'col-md-4';
                col.innerHTML = `
        <div class="card card-modern h-100 fade-in">
          <div class="position-relative">
            <img src="https://img.youtube.com/vi/${content.type === 'playlist' ? '' : content.id}/mqdefault.jpg" class="card-img-top" alt="${escapeHtml(content.title)}">
            <div class="position-absolute top-50 start-50 translate-middle">
              <button class="btn btn-danger rounded-circle" onclick="playYoutube('${content.type}', '${content.id}', '${escapeHtml(content.title)}')">
                <i class="bi bi-play-fill fs-4"></i>
              </button>
            </div>
          </div>
          <div class="card-body">
            <h6 class="card-title">${escapeHtml(content.title || 'Sans titre')}</h6>
            <small class="text-muted">${content.type.charAt(0).toUpperCase() + content.type.slice(1)} - Par ${escapeHtml(content.userName)}</small>
          </div>
        </div>
      `;
                grid.appendChild(col);
            });
        }

        function renderDocuments() {
            const grid = document.getElementById('documentsGrid');
            const docs = allFiles.filter(f => {
                const mime = f.mimeType || '';
                return mime.includes('pdf') || mime.includes('document') || mime.includes('spreadsheet') || mime.includes('presentation');
            });

            grid.innerHTML = '';
            if (!docs.length) {
                grid.innerHTML = '<div class="col-12 text-center text-muted py-5"><i class="bi bi-file-earmark fs-1"></i><p class="mt-2">Aucun document trouvé</p></div>';
                return;
            }

            docs.forEach(file => {
                const meta = getFileMeta(file.mimeType);
                const col = document.createElement('div');
                col.className = 'col-lg-4 col-md-6';
                col.innerHTML = `
        <div class="card card-modern h-100 fade-in">
          <div class="card-body">
            <div class="d-flex gap-3 mb-3">
              <div style="font-size:48px; color:${meta.color}">
                <i class="${meta.icon}"></i>
              </div>
              <div class="flex-grow-1">
                <h6 class="mb-1">${escapeHtml(file.name)}</h6>
                <small class="text-muted">${meta.label}</small>
                ${file.modifiedTime ? `<div><small class="text-muted">Modifié : ${new Date(file.modifiedTime).toLocaleDateString('fr-FR')}</small></div>` : ''}
              </div>
            </div>
            <div class="d-grid gap-2">
              <button class="btn btn-sm btn-primary" onclick="viewDocument('${file.id}', '${escapeHtml(file.name)}', '${file.webViewLink || ''}', '${meta.kind}')">
                <i class="bi bi-eye me-1"></i>Voir
              </button>
              ${file.webContentLink ?
                        `<a class="btn btn-sm btn-outline-secondary" href="${file.webContentLink}" target="_blank">
                  <i class="bi bi-download me-1"></i>Télécharger
                </a>` : ''}
            </div>
          </div>
        </div>
      `;
                grid.appendChild(col);
            });
        }

        function renderAssignments() {
            const grid = document.getElementById('assignmentsGrid');
            grid.innerHTML = '';
            // Exemples de devoirs (peuvent être fetched de Firestore)
            const assignments = [
                { name: 'Devoir 1 : Algorithmes', due: '2025-10-20', status: 'En attente' },
                { name: 'Devoir 2 : Bases de données', due: '2025-10-25', status: 'Soumis' }
            ];

            assignments.forEach(ass => {
                const col = document.createElement('div');
                col.className = 'col-md-6';
                col.innerHTML = `
        <div class="card card-modern fade-in">
          <div class="card-body">
            <h6>${ass.name}</h6>
            <p class="text-muted">Échéance : ${ass.due}</p>
            <p>Statut : ${ass.status}</p>
            <button class="btn btn-primary">Soumettre</button>
          </div>
        </div>
      `;
                grid.appendChild(col);
            });
        }

        function renderCalendar() {
            const eventsDiv = document.getElementById('calendarEvents');
            eventsDiv.innerHTML = '';
            // Exemples d'événements
            const events = [
                { date: '2025-10-18', title: 'Examen de base de données', time: '10:00' },
                { date: '2025-10-20', title: 'Soumission de projet', time: '23:59' }
            ];

            events.forEach(ev => {
                const item = document.createElement('div');
                item.className = 'timeline-item fade-in';
                item.innerHTML = `
        <div class="timeline-dot"><i class="bi bi-calendar"></i></div>
        <div>
          <strong>${ev.title}</strong>
          <p class="text-muted small mb-0">${ev.date} à ${ev.time}</p>
        </div>
      `;
                eventsDiv.appendChild(item);
            });
        }

        function renderNotes() {
            const list = document.getElementById('notesList');
            list.innerHTML = '';

            notes.forEach((note, index) => {
                const col = document.createElement('div');
                col.className = 'col-md-4';
                col.innerHTML = `
        <div class="card card-modern fade-in">
          <div class="card-body">
            <h6>${note.title}</h6>
            <p class="text-muted small">${note.date}</p>
            <p>${note.content.substring(0, 100)}...</p>
            <button class="btn btn-sm btn-danger" onclick="deleteNote(${index})">Supprimer</button>
          </div>
        </div>
      `;
                list.appendChild(col);
            });
        }

        window.deleteNote = function (index) {
            notes.splice(index, 1);
            localStorage.setItem('notes', JSON.stringify(notes));
            renderNotes();
        };

        function renderProgress() {
            const ctx = document.getElementById('progressChart').getContext('2d');
            const completed = Object.values(userProgress).filter(p => p === 100).length;
            const inProgress = Object.values(userProgress).filter(p => p > 0 && p < 100).length;
            const notStarted = allFiles.length - completed - inProgress;

            new Chart(ctx, {
                type: 'pie',
                data: {
                    labels: ['Complétés', 'En cours', 'Non commencés'],
                    datasets: [{
                        data: [completed, inProgress, notStarted],
                        backgroundColor: ['#28a745', '#ffc107', '#dc3545']
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: { position: 'top' }
                    }
                }
            });
        }

        function renderSettings() {
            // Déjà rendu, rien à ajouter
        }

        function updateStats() {
            const total = allFiles.length;
            const completed = Object.values(userProgress).filter(p => p === 100).length;
            const inProgress = Object.values(userProgress).filter(p => p > 0 && p < 100).length;

            document.getElementById('totalCourses').innerText = total;
            document.getElementById('completedCourses').innerText = completed;
            document.getElementById('inProgressCourses').innerText = inProgress;
        }

        function filterCourses(query) {
            const cards = document.querySelectorAll('#coursesGrid .col-xl-3, #coursesGrid .col-lg-4, #coursesGrid .col-md-6');
            cards.forEach(card => {
                const title = card.querySelector('.card-title')?.innerText.toLowerCase() || '';
                card.style.display = title.includes(query) ? '' : 'none';
            });
        }

        // Fonctions globales
        window.playVideo = function (fileId, title, url) {
            document.getElementById('videoTitle').innerText = title;
            const container = document.getElementById('videoContainer');

            const videoId = extractVideoId(url);
            if (videoId) {
                container.innerHTML = `<iframe src="https://www.youtube.com/embed/${videoId}?autoplay=1" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>`;
            } else if (fileId) {
                container.innerHTML = `<iframe src="https://drive.google.com/file/d/${fileId}/preview" frameborder="0" allowfullscreen></iframe>`;
            } else {
                container.innerHTML = `<div class="p-5 text-center text-muted"><i class="bi bi-exclamation-triangle fs-1"></i><p class="mt-2">Vidéo non disponible</p></div>`;
            }

            videoModal.show();

            if (!userProgress[fileId]) {
                saveProgress(fileId, 25);
            }
        };

        window.playYoutube = function (type, id, title) {
            document.getElementById('videoTitle').innerText = title;
            const container = document.getElementById('videoContainer');
            const src = type === 'playlist' ? `https://www.youtube.com/embed/videoseries?list=${id}` : `https://www.youtube.com/embed/${id}`;
            container.innerHTML = `<iframe src="${src}" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>`;
            videoModal.show();
        };

        window.viewDocument = function (fileId, title, url, kind) {
            document.getElementById('documentTitle').innerText = title;
            const container = document.getElementById('documentContainer');

            container.innerHTML = `<iframe src="https://drive.google.com/file/d/${fileId}/preview" frameborder="0"></iframe>`;

            documentModal.show();

            if (!userProgress[fileId]) {
                saveProgress(fileId, 25);
            }
        };

        window.markComplete = function (fileId) {
            saveProgress(fileId, 100);
            renderCourses();
            renderDashboard();

            const toast = document.createElement('div');
            toast.className = 'position-fixed top-0 end-0 p-3';
            toast.style.zIndex = '9999';
            toast.innerHTML = `
      <div class="alert alert-success alert-dismissible fade show" role="alert">
        <i class="bi bi-check-circle me-2"></i>Cours marqué comme complété !
        <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
      </div>`;
            document.body.appendChild(toast);
            setTimeout(() => toast.remove(), 3000);
        };

        window.resumeCourse = function (fileId) {
            const file = allFiles.find(f => f.id === fileId);
            if (!file) return;

            const meta = getFileMeta(file.mimeType);
            if (meta.kind === 'video') {
                playVideo(file.id, file.name, file.webViewLink);
            } else {
                viewDocument(file.id, file.name, file.webViewLink, meta.kind);
            }

            const currentProgress = userProgress[fileId] || 0;
            if (currentProgress < 100) {
                saveProgress(fileId, Math.min(currentProgress + 25, 100));
            }
        };

        window.saveForLater = function (fileId) {
            const saved = JSON.parse(localStorage.getItem('savedCourses') || '[]');
            if (!saved.includes(fileId)) {
                saved.push(fileId);
                localStorage.setItem('savedCourses', JSON.stringify(saved));

                const toast = document.createElement('div');
                toast.className = 'position-fixed top-0 end-0 p-3';
                toast.style.zIndex = '9999';
                toast.innerHTML = `
        <div class="alert alert-info alert-dismissible fade show" role="alert">
          <i class="bi bi-bookmark-fill me-2"></i>Enregistré pour plus tard !
          <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
        </div>`;
                document.body.appendChild(toast);
                setTimeout(() => toast.remove(), 3000);
            }
        };

        window.openFolder = function (folderId, name) {
            folderPath.push({ id: folderId, name });
            currentFolderId = folderId;
            fetchDriveFolder(folderId);
        };

        // Filtre catégorie
        document.getElementById('categoryFilter')?.addEventListener('change', (e) => {
            const value = e.target.value;
            const cards = document.querySelectorAll('#coursesGrid > div');

            cards.forEach(card => {
                if (value === 'all') {
                    card.style.display = '';
                } else {
                    const badge = card.querySelector('.course-badge')?.innerText.toLowerCase() || '';
                    card.style.display = badge.includes(value) ? '' : 'none';
                }
            });
        });

        // Tri
        document.getElementById('sortBy')?.addEventListener('change', (e) => {
            const value = e.target.value;
            if (value === 'Trier par nom') {
                currentFiles.sort((a, b) => a.name.localeCompare(b.name));
            } else if (value === 'Trier par date') {
                currentFiles.sort((a, b) => new Date(b.modifiedTime) - new Date(a.modifiedTime));
            } else if (value === 'Trier par type') {
                currentFiles.sort((a, b) => a.mimeType.localeCompare(b.mimeType));
            }
            renderCourses();
        });

        function escapeHtml(str) {
            if (!str) return '';
            const div = document.createElement('div');
            div.textContent = str;
            return div.innerHTML;
        }

        function setTheme(theme) {
            localStorage.setItem('theme', theme);
            if (theme === 'system') {
                document.body.removeAttribute('data-theme');
            } else {
                document.body.setAttribute('data-theme', theme);
            }
        }

        function loadTheme() {
            const theme = localStorage.getItem('theme') || 'system';
            const select = document.getElementById('themeSelect');
            if (select) select.value = theme;
            setTheme(theme);
        }

        // Initialisation
        fetchDriveFolder(currentFolderId);
    </script>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.4/dist/chart.umd.min.js"></script>
    <!-- Firestore Security Rules:
rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {
    match /contributed/{document=**} {
      allow read: if true;
      allow create: if request.auth != null;
      allow update, delete: if request.auth.uid == resource.data.userId;
    }
  }
}
-->
</body>

</html>
