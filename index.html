<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Party System with Firebase</title>
<style>
  body {
    font-family: Arial, sans-serif;
    max-width: 500px;
    margin: 40px auto;
    padding: 10px;
  }
  h1 {
    text-align: center;
  }
  input, button {
    padding: 8px;
    margin: 6px 0;
    width: 100%;
    box-sizing: border-box;
  }
  .section {
    border: 1px solid #ddd;
    padding: 15px;
    margin-bottom: 20px;
    border-radius: 6px;
  }
  .party-info {
    background: #f0f8ff;
    padding: 10px;
    border-radius: 6px;
  }
  .error {
    color: red;
  }
  .success {
    color: green;
  }
</style>
</head>
<body>

<h1>Party System</h1>

<div class="section" id="create-party-section">
  <h2>Create Party</h2>
  <input type="text" id="partyName" placeholder="Party Name" />
  <textarea id="partyDesc" placeholder="Party Description" rows="3"></textarea>
  <button id="createPartyBtn">Create Party</button>
  <p id="createResult"></p>
</div>

<div class="section" id="join-party-section">
  <h2>Join Party</h2>
  <input type="text" id="joinPartyKey" placeholder="Enter Party Key" />
  <button id="joinPartyBtn">Join Party</button>
  <p id="joinResult"></p>
</div>

<div class="section" id="partyDetails" style="display:none;">
  <h2>Party Details</h2>
  <div class="party-info" id="partyInfo"></div>
</div>

<script type="module">
// Firebase imports & init
import { initializeApp } from "https://www.gstatic.com/firebasejs/11.10.0/firebase-app.js";
import { getDatabase, ref, set, get, child, push } from "https://www.gstatic.com/firebasejs/11.10.0/firebase-database.js";

const firebaseConfig = {
  apiKey: "AIzaSyDp2V0ULE-32AcIJ92a_e3mhMe6f6yZ_H4",
  authDomain: "sm4movies.firebaseapp.com",
  databaseURL: "https://sm4movies-default-rtdb.firebaseio.com",
  projectId: "sm4movies",
  storageBucket: "sm4movies.firebasestorage.app",
  messagingSenderId: "277353836953",
  appId: "1:277353836953:web:85e02783526c7cb58de308",
  measurementId: "G-690RSNJ2Q2"
};

// Initialize Firebase app and DB
const app = initializeApp(firebaseConfig);
const db = getDatabase(app);

// UI Elements
const partyNameInput = document.getElementById("partyName");
const partyDescInput = document.getElementById("partyDesc");
const createPartyBtn = document.getElementById("createPartyBtn");
const createResult = document.getElementById("createResult");

const joinPartyKeyInput = document.getElementById("joinPartyKey");
const joinPartyBtn = document.getElementById("joinPartyBtn");
const joinResult = document.getElementById("joinResult");

const partyDetailsSection = document.getElementById("partyDetails");
const partyInfoDiv = document.getElementById("partyInfo");

// Generate a random key for party (short)
function generatePartyKey() {
  return Math.random().toString(36).substring(2, 8).toUpperCase(); // e.g. 'AB12CD'
}

// Create party handler
createPartyBtn.addEventListener("click", async () => {
  const name = partyNameInput.value.trim();
  const desc = partyDescInput.value.trim();

  if (!name) {
    createResult.textContent = "Party name is required.";
    createResult.className = "error";
    return;
  }

  // Generate key
  const key = generatePartyKey();

  // Save party in Firebase
  try {
    await set(ref(db, "parties/" + key), {
      name,
      description: desc,
      createdAt: Date.now()
    });

    createResult.textContent = `Party created! Your party key is: ${key}`;
    createResult.className = "success";

    // Clear inputs
    partyNameInput.value = "";
    partyDescInput.value = "";
  } catch (err) {
    createResult.textContent = "Error creating party: " + err.message;
    createResult.className = "error";
  }
});

// Join party handler
joinPartyBtn.addEventListener("click", async () => {
  const key = joinPartyKeyInput.value.trim().toUpperCase();

  if (!key) {
    joinResult.textContent = "Please enter a party key.";
    joinResult.className = "error";
    return;
  }

  try {
    const partySnapshot = await get(ref(db, "parties/" + key));
    if (partySnapshot.exists()) {
      const partyData = partySnapshot.val();
      joinResult.textContent = "Joined party successfully!";
      joinResult.className = "success";

      // Show party details
      partyInfoDiv.innerHTML = `
        <strong>Name:</strong> ${partyData.name} <br/>
        <strong>Description:</strong> ${partyData.description || "No description"} <br/>
        <strong>Created:</strong> ${new Date(partyData.createdAt).toLocaleString()}
      `;
      partyDetailsSection.style.display = "block";

      // Clear join input
      joinPartyKeyInput.value = "";

    } else {
      joinResult.textContent = "Party not found with that key.";
      joinResult.className = "error";
      partyDetailsSection.style.display = "none";
    }
  } catch (err) {
    joinResult.textContent = "Error joining party: " + err.message;
    joinResult.className = "error";
    partyDetailsSection.style.display = "none";
  }
});
</script>

</body>
</html>
